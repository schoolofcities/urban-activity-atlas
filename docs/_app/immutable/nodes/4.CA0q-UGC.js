import{a as q,t as K,n as Qt}from"../chunks/disclose-version.ED88iaox.js";import{s as C,v as M,p as an,aD as ce,aE as on,t as P,o as sn,g as p,a0 as H,w as $,aF as J,aj as Vn,m as fe,e as Un,aG as Gn,aH as re}from"../chunks/runtime.CMzVgPk-.js";import{e as It,s as it,a as Wn}from"../chunks/render.BB75Lrgo.js";import{s as k,l as Yn,e as dt,b as Jn,h as Zn,c as Kn,i as pt,r as Qn,t as ie}from"../chunks/top-logo-full.hV0_nWZZ.js";import{p as nt,i as ln}from"../chunks/props.DsxLIusu.js";import{i as un}from"../chunks/lifecycle.H_2vOfLT.js";import{o as cn,a as jn}from"../chunks/index-client.BIhkd_L2.js";const tr=!0,Us=Object.freeze(Object.defineProperty({__proto__:null,prerender:tr},Symbol.toStringTag,{value:"Module"}));var er=K('<div id="bar" class="svelte-os6al8"><div id="logo" class="svelte-os6al8"><a href="https://www.schoolofcities.utoronto.ca/" class="svelte-os6al8"><img alt="School of Cities" class="svelte-os6al8"></a></div></div>');function nr(t){var e=er(),n=C(e),r=C(n),i=C(r);k(i,"src",Yn),M(r),M(n),M(e),q(t,e)}var rr=K("<span> </span>"),ir=K('<button aria-label="Play" class="svelte-14u9mog"><svg width="12" height="12" viewBox="0 0 12 12" fill="white" xmlns="http://www.w3.org/2000/svg"><polygon points="2,1 10,6 2,11"></polygon></svg></button>'),ar=K('<button aria-label="Stop" class="svelte-14u9mog"><svg width="12" height="12" viewBox="0 0 12 12" fill="white" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="8" height="8"></rect></svg></button>'),or=K('<span class="svelte-14u9mog"> </span>'),sr=K('<div class="container svelte-14u9mog"><h3 class="svelte-14u9mog"> </h3> <div class="legend-container svelte-14u9mog"><div class="gradient-legend svelte-14u9mog"></div> <div class="legend-labels svelte-14u9mog"></div></div> <div class="controls svelte-14u9mog"><div class="range-play-wrapper svelte-14u9mog"><!> <div class="slider-wrapper svelte-14u9mog"><input type="range" min="0" max="23" step="1" class="custom-slider svelte-14u9mog"> <div class="ticks svelte-14u9mog"></div></div></div></div> <div class="mode-toggle svelte-14u9mog"><button class="svelte-14u9mog">Weekday</button> <button class="svelte-14u9mog">Weekend</button></div> <img loading="lazy" decoding="async" class="svelte-14u9mog"></div>');function Re(t,e){an(e,!1);const n=J(),r=J();let i=nt(e,"title",8,""),a=nt(e,"folder_weekday",8,""),o=nt(e,"folder_weekend",8,""),s=nt(e,"legendColors",24,()=>[]),u=nt(e,"legendLabels",24,()=>[]),l=J(),c=J(0),f=null,h=J(!1),d=J(!1),v=[],m=J("weekday");function b(E){E==="weekday"?H(l,a()):H(l,o()),H(m,E),A()}function N(E){"requestIdleCallback"in window?requestIdleCallback(E,{timeout:2e3}):setTimeout(E,100)}async function T(E){return new Promise(I=>{const V=new Image;V.src=E,V.decoding="async";let B=!1;V.onload=()=>{B||(v.push(E),B=!0,I())},V.onerror=()=>{B||(B=!0,I())},V.decode&&V.decode().then(()=>{B||(v.push(E),B=!0,I())}).catch(()=>{})})}async function A(){H(d,!1),v=[],await T(p(n)[0]),setTimeout(async()=>{await Promise.all([T(p(n)[1]),T(p(n)[2]),T(p(n)[3])])},50),p(n).slice(4).forEach(E=>{N(()=>T(E))}),H(d,!0)}cn(()=>{b("weekday")}),jn(()=>{clearInterval(f)});function R(){!p(h)&&p(d)&&(H(h,!0),f=setInterval(()=>{H(c,(p(c)+1)%24)},250))}function g(){H(h,!1),clearInterval(f)}ce(()=>p(l),()=>{H(n,Array.from({length:24},(E,I)=>`/urban-activity-atlas/${p(l)}/Hour_${I}.png`))}),ce(()=>{},()=>{H(r,Array.from({length:24},(E,I)=>I))}),on(),un();var _=sr(),w=C(_),x=C(w,!0);M(w);var S=$(w,2),F=C(S);const y=Vn(()=>`background: linear-gradient(to right, ${s().join(",")??""})`);var D=$(F,2);dt(D,5,u,pt,(E,I,V)=>{var B=rr();Kn(B,`label-${V??""} svelte-14u9mog`);var Bn=C(B,!0);M(B),P(()=>it(Bn,p(I))),q(E,B)}),M(D),M(S);var z=$(S,2),j=C(z),wt=C(j);ln(wt,()=>!p(h),E=>{var I=ir();P(()=>I.disabled=!p(d)),It("click",I,R),q(E,I)},E=>{var I=ar();It("click",I,g),q(E,I)});var at=$(wt,2),tt=C(at);Qn(tt);var ot=$(tt,2);dt(ot,5,()=>p(r),pt,(E,I)=>{var V=or(),B=C(V,!0);M(V),P(()=>it(B,p(I))),q(E,V)}),M(ot),M(at),M(j),M(z);var X=$(z,2),ne=C(X),Ie=$(ne,2);M(X);var zt=$(X,2);M(_),P(()=>{it(x,i()),k(F,"style",p(y)),tt.disabled=!p(d),ie(ne,"selected",p(m)==="weekday"),ie(Ie,"selected",p(m)==="weekend"),k(zt,"src",p(d)?p(n)[p(c)]:"/urban-activity-atlas/exploring-hourly-activity-toronto/blank-image.png"),k(zt,"alt",`Hour ${p(c)}`),ie(zt,"loading",!p(d))}),Jn(tt,()=>p(c),E=>H(c,E)),It("click",ne,()=>b("weekday")),It("click",Ie,()=>b("weekend")),Zn(zt),q(t,_),sn()}function Ht(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function lr(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function fn(t){let e,n,r;t.length!==2?(e=Ht,n=(s,u)=>Ht(t(s),u),r=(s,u)=>t(s)-u):(e=t===Ht||t===lr?t:ur,n=t,r=t);function i(s,u,l=0,c=s.length){if(l<c){if(e(u,u)!==0)return c;do{const f=l+c>>>1;n(s[f],u)<0?l=f+1:c=f}while(l<c)}return l}function a(s,u,l=0,c=s.length){if(l<c){if(e(u,u)!==0)return c;do{const f=l+c>>>1;n(s[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(s,u,l=0,c=s.length){const f=i(s,u,l,c-1);return f>l&&r(s[f-1],u)>-r(s[f],u)?f-1:f}return{left:i,center:o,right:a}}function ur(){return 0}function cr(t){return t===null?NaN:+t}const fr=fn(Ht),hr=fr.right;fn(cr).center;const dr=Math.sqrt(50),pr=Math.sqrt(10),vr=Math.sqrt(2);function Xt(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=dr?10:a>=pr?5:a>=vr?2:1;let s,u,l;return i<0?(l=Math.pow(10,-i)/o,s=Math.round(t*l),u=Math.round(e*l),s/l<t&&++s,u/l>e&&--u,l=-l):(l=Math.pow(10,i)*o,s=Math.round(t/l),u=Math.round(e/l),s*l<t&&++s,u*l>e&&--u),u<s&&.5<=n&&n<2?Xt(t,e,n*2):[s,u,l]}function gr(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,o]=r?Xt(e,t,n):Xt(t,e,n);if(!(a>=i))return[];const s=a-i+1,u=new Array(s);if(r)if(o<0)for(let l=0;l<s;++l)u[l]=(a-l)/-o;else for(let l=0;l<s;++l)u[l]=(a-l)*o;else if(o<0)for(let l=0;l<s;++l)u[l]=(i+l)/-o;else for(let l=0;l<s;++l)u[l]=(i+l)*o;return u}function he(t,e,n){return e=+e,t=+t,n=+n,Xt(t,e,n)[2]}function mr(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?he(e,t,n):he(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function yr(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function _r(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}var wr={value:()=>{}};function hn(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Lt(n)}function Lt(t){this._=t}function xr(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Lt.prototype=hn.prototype={constructor:Lt,on:function(t,e){var n=this._,r=xr(t+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(t=r[a]).type)&&(i=br(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(i=(t=r[a]).type)n[i]=Pe(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Pe(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Lt(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function br(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Pe(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=wr,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var de="http://www.w3.org/1999/xhtml";const Fe={svg:"http://www.w3.org/2000/svg",xhtml:de,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function jt(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Fe.hasOwnProperty(e)?{space:Fe[e],local:t}:t}function kr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===de&&e.documentElement.namespaceURI===de?e.createElement(t):e.createElementNS(n,t)}}function Ar(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function dn(t){var e=jt(t);return(e.local?Ar:kr)(e)}function Mr(){}function Ae(t){return t==null?Mr:function(){return this.querySelector(t)}}function Tr(t){typeof t!="function"&&(t=Ae(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=new Array(o),u,l,c=0;c<o;++c)(u=a[c])&&(l=t.call(u,u.__data__,c,a))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new W(r,this._parents)}function $r(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Nr(){return[]}function pn(t){return t==null?Nr:function(){return this.querySelectorAll(t)}}function Sr(t){return function(){return $r(t.apply(this,arguments))}}function Er(t){typeof t=="function"?t=Sr(t):t=pn(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o=e[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&(r.push(t.call(u,u.__data__,l,o)),i.push(u));return new W(r,i)}function vn(t){return function(){return this.matches(t)}}function gn(t){return function(e){return e.matches(t)}}var Cr=Array.prototype.find;function zr(t){return function(){return Cr.call(this.children,t)}}function Ir(){return this.firstElementChild}function Rr(t){return this.select(t==null?Ir:zr(typeof t=="function"?t:gn(t)))}var Pr=Array.prototype.filter;function Fr(){return Array.from(this.children)}function Dr(t){return function(){return Pr.call(this.children,t)}}function Hr(t){return this.selectAll(t==null?Fr:Dr(typeof t=="function"?t:gn(t)))}function Lr(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],u,l=0;l<o;++l)(u=a[l])&&t.call(u,u.__data__,l,a)&&s.push(u);return new W(r,this._parents)}function mn(t){return new Array(t.length)}function qr(){return new W(this._enter||this._groups.map(mn),this._parents)}function Bt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Bt.prototype={constructor:Bt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Or(t){return function(){return t}}function Xr(t,e,n,r,i,a){for(var o=0,s,u=e.length,l=a.length;o<l;++o)(s=e[o])?(s.__data__=a[o],r[o]=s):n[o]=new Bt(t,a[o]);for(;o<u;++o)(s=e[o])&&(i[o]=s)}function Br(t,e,n,r,i,a,o){var s,u,l=new Map,c=e.length,f=a.length,h=new Array(c),d;for(s=0;s<c;++s)(u=e[s])&&(h[s]=d=o.call(u,u.__data__,s,e)+"",l.has(d)?i[s]=u:l.set(d,u));for(s=0;s<f;++s)d=o.call(t,a[s],s,a)+"",(u=l.get(d))?(r[s]=u,u.__data__=a[s],l.delete(d)):n[s]=new Bt(t,a[s]);for(s=0;s<c;++s)(u=e[s])&&l.get(h[s])===u&&(i[s]=u)}function Vr(t){return t.__data__}function Ur(t,e){if(!arguments.length)return Array.from(this,Vr);var n=e?Br:Xr,r=this._parents,i=this._groups;typeof t!="function"&&(t=Or(t));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=r[l],f=i[l],h=f.length,d=Gr(t.call(c,c&&c.__data__,l,r)),v=d.length,m=s[l]=new Array(v),b=o[l]=new Array(v),N=u[l]=new Array(h);n(c,f,m,b,N,d,e);for(var T=0,A=0,R,g;T<v;++T)if(R=m[T]){for(T>=A&&(A=T+1);!(g=b[A])&&++A<v;);R._next=g||null}}return o=new W(o,r),o._enter=s,o._exit=u,o}function Gr(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Wr(){return new W(this._exit||this._groups.map(mn),this._parents)}function Yr(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function Jr(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),u=0;u<o;++u)for(var l=n[u],c=r[u],f=l.length,h=s[u]=new Array(f),d,v=0;v<f;++v)(d=l[v]||c[v])&&(h[v]=d);for(;u<i;++u)s[u]=n[u];return new W(s,this._parents)}function Zr(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function Kr(t){t||(t=Qr);function e(f,h){return f&&h?t(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o=n[a],s=o.length,u=i[a]=new Array(s),l,c=0;c<s;++c)(l=o[c])&&(u[c]=l);u.sort(e)}return new W(i,this._parents).order()}function Qr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function jr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ti(){return Array.from(this)}function ei(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function ni(){let t=0;for(const e of this)++t;return t}function ri(){return!this.node()}function ii(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length,s;a<o;++a)(s=i[a])&&t.call(s,s.__data__,a,i);return this}function ai(t){return function(){this.removeAttribute(t)}}function oi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function si(t,e){return function(){this.setAttribute(t,e)}}function li(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ui(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function ci(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function fi(t,e){var n=jt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?oi:ai:typeof e=="function"?n.local?ci:ui:n.local?li:si)(n,e))}function yn(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function hi(t){return function(){this.style.removeProperty(t)}}function di(t,e,n){return function(){this.style.setProperty(t,e,n)}}function pi(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function vi(t,e,n){return arguments.length>1?this.each((e==null?hi:typeof e=="function"?pi:di)(t,e,n??"")):mt(this.node(),t)}function mt(t,e){return t.style.getPropertyValue(e)||yn(t).getComputedStyle(t,null).getPropertyValue(e)}function gi(t){return function(){delete this[t]}}function mi(t,e){return function(){this[t]=e}}function yi(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function _i(t,e){return arguments.length>1?this.each((e==null?gi:typeof e=="function"?yi:mi)(t,e)):this.node()[t]}function _n(t){return t.trim().split(/^|\s+/)}function Me(t){return t.classList||new wn(t)}function wn(t){this._node=t,this._names=_n(t.getAttribute("class")||"")}wn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function xn(t,e){for(var n=Me(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function bn(t,e){for(var n=Me(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function wi(t){return function(){xn(this,t)}}function xi(t){return function(){bn(this,t)}}function bi(t,e){return function(){(e.apply(this,arguments)?xn:bn)(this,t)}}function ki(t,e){var n=_n(t+"");if(arguments.length<2){for(var r=Me(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?bi:e?wi:xi)(n,e))}function Ai(){this.textContent=""}function Mi(t){return function(){this.textContent=t}}function Ti(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function $i(t){return arguments.length?this.each(t==null?Ai:(typeof t=="function"?Ti:Mi)(t)):this.node().textContent}function Ni(){this.innerHTML=""}function Si(t){return function(){this.innerHTML=t}}function Ei(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ci(t){return arguments.length?this.each(t==null?Ni:(typeof t=="function"?Ei:Si)(t)):this.node().innerHTML}function zi(){this.nextSibling&&this.parentNode.appendChild(this)}function Ii(){return this.each(zi)}function Ri(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Pi(){return this.each(Ri)}function Fi(t){var e=typeof t=="function"?t:dn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Di(){return null}function Hi(t,e){var n=typeof t=="function"?t:dn(t),r=e==null?Di:typeof e=="function"?e:Ae(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Li(){var t=this.parentNode;t&&t.removeChild(this)}function qi(){return this.each(Li)}function Oi(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Xi(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Bi(t){return this.select(t?Xi:Oi)}function Vi(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Ui(t){return function(e){t.call(this,e,this.__data__)}}function Gi(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Wi(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function Yi(t,e,n){return function(){var r=this.__on,i,a=Ui(e);if(r){for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function Ji(t,e,n){var r=Gi(t+""),i,a=r.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(i=0,c=s[u];i<a;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(s=e?Yi:Wi,i=0;i<a;++i)this.each(s(r[i],e,n));return this}function kn(t,e,n){var r=yn(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Zi(t,e){return function(){return kn(this,t,e)}}function Ki(t,e){return function(){return kn(this,t,e.apply(this,arguments))}}function Qi(t,e){return this.each((typeof e=="function"?Ki:Zi)(t,e))}function*ji(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var ta=[null];function W(t,e){this._groups=t,this._parents=e}function Et(){return new W([[document.documentElement]],ta)}function ea(){return this}W.prototype=Et.prototype={constructor:W,select:Tr,selectAll:Er,selectChild:Rr,selectChildren:Hr,filter:Lr,data:Ur,enter:qr,exit:Wr,join:Yr,merge:Jr,selection:ea,order:Zr,sort:Kr,call:jr,nodes:ti,node:ei,size:ni,empty:ri,each:ii,attr:fi,style:vi,property:_i,classed:ki,text:$i,html:Ci,raise:Ii,lower:Pi,append:Fi,insert:Hi,remove:qi,clone:Bi,datum:Vi,on:Ji,dispatch:Qi,[Symbol.iterator]:ji};function Te(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function An(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ct(){}var $t=.7,Vt=1/$t,gt="\\s*([+-]?\\d+)\\s*",Nt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Z="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",na=/^#([0-9a-f]{3,8})$/,ra=new RegExp(`^rgb\\(${gt},${gt},${gt}\\)$`),ia=new RegExp(`^rgb\\(${Z},${Z},${Z}\\)$`),aa=new RegExp(`^rgba\\(${gt},${gt},${gt},${Nt}\\)$`),oa=new RegExp(`^rgba\\(${Z},${Z},${Z},${Nt}\\)$`),sa=new RegExp(`^hsl\\(${Nt},${Z},${Z}\\)$`),la=new RegExp(`^hsla\\(${Nt},${Z},${Z},${Nt}\\)$`),De={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Te(Ct,ct,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:He,formatHex:He,formatHex8:ua,formatHsl:ca,formatRgb:Le,toString:Le});function He(){return this.rgb().formatHex()}function ua(){return this.rgb().formatHex8()}function ca(){return Mn(this).formatHsl()}function Le(){return this.rgb().formatRgb()}function ct(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=na.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?qe(e):n===3?new O(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Rt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Rt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ra.exec(t))?new O(e[1],e[2],e[3],1):(e=ia.exec(t))?new O(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=aa.exec(t))?Rt(e[1],e[2],e[3],e[4]):(e=oa.exec(t))?Rt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=sa.exec(t))?Be(e[1],e[2]/100,e[3]/100,1):(e=la.exec(t))?Be(e[1],e[2]/100,e[3]/100,e[4]):De.hasOwnProperty(t)?qe(De[t]):t==="transparent"?new O(NaN,NaN,NaN,0):null}function qe(t){return new O(t>>16&255,t>>8&255,t&255,1)}function Rt(t,e,n,r){return r<=0&&(t=e=n=NaN),new O(t,e,n,r)}function fa(t){return t instanceof Ct||(t=ct(t)),t?(t=t.rgb(),new O(t.r,t.g,t.b,t.opacity)):new O}function pe(t,e,n,r){return arguments.length===1?fa(t):new O(t,e,n,r??1)}function O(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Te(O,pe,An(Ct,{brighter(t){return t=t==null?Vt:Math.pow(Vt,t),new O(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?$t:Math.pow($t,t),new O(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new O(ut(this.r),ut(this.g),ut(this.b),Ut(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Oe,formatHex:Oe,formatHex8:ha,formatRgb:Xe,toString:Xe}));function Oe(){return`#${lt(this.r)}${lt(this.g)}${lt(this.b)}`}function ha(){return`#${lt(this.r)}${lt(this.g)}${lt(this.b)}${lt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xe(){const t=Ut(this.opacity);return`${t===1?"rgb(":"rgba("}${ut(this.r)}, ${ut(this.g)}, ${ut(this.b)}${t===1?")":`, ${t})`}`}function Ut(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ut(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function lt(t){return t=ut(t),(t<16?"0":"")+t.toString(16)}function Be(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new G(t,e,n,r)}function Mn(t){if(t instanceof G)return new G(t.h,t.s,t.l,t.opacity);if(t instanceof Ct||(t=ct(t)),!t)return new G;if(t instanceof G)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new G(o,s,u,t.opacity)}function da(t,e,n,r){return arguments.length===1?Mn(t):new G(t,e,n,r??1)}function G(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Te(G,da,An(Ct,{brighter(t){return t=t==null?Vt:Math.pow(Vt,t),new G(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?$t:Math.pow($t,t),new G(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new O(ae(t>=240?t-240:t+120,i,r),ae(t,i,r),ae(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new G(Ve(this.h),Pt(this.s),Pt(this.l),Ut(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ut(this.opacity);return`${t===1?"hsl(":"hsla("}${Ve(this.h)}, ${Pt(this.s)*100}%, ${Pt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Ve(t){return t=(t||0)%360,t<0?t+360:t}function Pt(t){return Math.max(0,Math.min(1,t||0))}function ae(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const $e=t=>()=>t;function pa(t,e){return function(n){return t+n*e}}function va(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function ga(t){return(t=+t)==1?Tn:function(e,n){return n-e?va(e,n,t):$e(isNaN(e)?n:e)}}function Tn(t,e){var n=e-t;return n?pa(t,n):$e(isNaN(t)?e:t)}const Gt=function t(e){var n=ga(e);function r(i,a){var o=n((i=pe(i)).r,(a=pe(a)).r),s=n(i.g,a.g),u=n(i.b,a.b),l=Tn(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=t,r}(1);function ma(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function ya(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function _a(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=Ne(t[o],e[o]);for(;o<n;++o)a[o]=e[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function wa(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function U(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function xa(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Ne(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var ve=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oe=new RegExp(ve.source,"g");function ba(t){return function(){return t}}function ka(t){return function(e){return t(e)+""}}function $n(t,e){var n=ve.lastIndex=oe.lastIndex=0,r,i,a,o=-1,s=[],u=[];for(t=t+"",e=e+"";(r=ve.exec(t))&&(i=oe.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:U(r,i)})),n=oe.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?u[0]?ka(u[0].x):ba(e):(e=u.length,function(l){for(var c=0,f;c<e;++c)s[(f=u[c]).i]=f.x(l);return s.join("")})}function Ne(t,e){var n=typeof e,r;return e==null||n==="boolean"?$e(e):(n==="number"?U:n==="string"?(r=ct(e))?(e=r,Gt):$n:e instanceof ct?Gt:e instanceof Date?wa:ya(e)?ma:Array.isArray(e)?_a:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?xa:U)(t,e)}function Aa(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Ue=180/Math.PI,ge={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Nn(t,e,n,r,i,a){var o,s,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Ue,skewX:Math.atan(u)*Ue,scaleX:o,scaleY:s}}var Ft;function Ma(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ge:Nn(e.a,e.b,e.c,e.d,e.e,e.f)}function Ta(t){return t==null||(Ft||(Ft=document.createElementNS("http://www.w3.org/2000/svg","g")),Ft.setAttribute("transform",t),!(t=Ft.transform.baseVal.consolidate()))?ge:(t=t.matrix,Nn(t.a,t.b,t.c,t.d,t.e,t.f))}function Sn(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function a(l,c,f,h,d,v){if(l!==f||c!==h){var m=d.push("translate(",null,e,null,n);v.push({i:m-4,x:U(l,f)},{i:m-2,x:U(c,h)})}else(f||h)&&d.push("translate("+f+e+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:U(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function s(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:U(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,v){if(l!==f||c!==h){var m=d.push(i(d)+"scale(",null,",",null,")");v.push({i:m-4,x:U(l,f)},{i:m-2,x:U(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=t(l),c=t(c),a(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),s(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var v=-1,m=h.length,b;++v<m;)f[(b=h[v]).i]=b.x(d);return f.join("")}}}var $a=Sn(Ma,"px, ","px)","deg)"),Na=Sn(Ta,", ",")",")"),yt=0,At=0,xt=0,En=1e3,Wt,Mt,Yt=0,ft=0,te=0,St=typeof performance=="object"&&performance.now?performance:Date,Cn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Se(){return ft||(Cn(Sa),ft=St.now()+te)}function Sa(){ft=0}function Jt(){this._call=this._time=this._next=null}Jt.prototype=zn.prototype={constructor:Jt,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Se():+n)+(e==null?0:+e),!this._next&&Mt!==this&&(Mt?Mt._next=this:Wt=this,Mt=this),this._call=t,this._time=n,me()},stop:function(){this._call&&(this._call=null,this._time=1/0,me())}};function zn(t,e,n){var r=new Jt;return r.restart(t,e,n),r}function Ea(){Se(),++yt;for(var t=Wt,e;t;)(e=ft-t._time)>=0&&t._call.call(void 0,e),t=t._next;--yt}function Ge(){ft=(Yt=St.now())+te,yt=At=0;try{Ea()}finally{yt=0,za(),ft=0}}function Ca(){var t=St.now(),e=t-Yt;e>En&&(te-=e,Yt=t)}function za(){for(var t,e=Wt,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Wt=n);Mt=t,me(r)}function me(t){if(!yt){At&&(At=clearTimeout(At));var e=t-ft;e>24?(t<1/0&&(At=setTimeout(Ge,t-St.now()-te)),xt&&(xt=clearInterval(xt))):(xt||(Yt=St.now(),xt=setInterval(Ca,En)),yt=1,Cn(Ge))}}function We(t,e,n){var r=new Jt;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Ia=hn("start","end","cancel","interrupt"),Ra=[],In=0,Ye=1,ye=2,qt=3,Je=4,_e=5,Ot=6;function ee(t,e,n,r,i,a){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Pa(t,n,{name:e,index:r,group:i,on:Ia,tween:Ra,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:In})}function Ee(t,e){var n=Y(t,e);if(n.state>In)throw new Error("too late; already scheduled");return n}function Q(t,e){var n=Y(t,e);if(n.state>qt)throw new Error("too late; already running");return n}function Y(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Pa(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=zn(a,0,n.time);function a(l){n.state=Ye,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var c,f,h,d;if(n.state!==Ye)return u();for(c in r)if(d=r[c],d.name===n.name){if(d.state===qt)return We(o);d.state===Je?(d.state=Ot,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<e&&(d.state=Ot,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(We(function(){n.state===qt&&(n.state=Je,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=ye,n.on.call("start",t,t.__data__,n.index,n.group),n.state===ye){for(n.state=qt,i=new Array(h=n.tween.length),c=0,f=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++f]=d);i.length=f+1}}function s(l){for(var c=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=_e,1),f=-1,h=i.length;++f<h;)i[f].call(t,c);n.state===_e&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=Ot,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function Fa(t,e){var n=t.__transition,r,i,a=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){a=!1;continue}i=r.state>ye&&r.state<_e,r.state=Ot,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}a&&delete t.__transition}}function Da(t){return this.each(function(){Fa(this,t)})}function Ha(t,e){var n,r;return function(){var i=Q(this,t),a=i.tween;if(a!==n){r=n=a;for(var o=0,s=r.length;o<s;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function La(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=Q(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:e,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===e){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function qa(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Y(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?Ha:La)(n,t,e))}function Ce(t,e,n){var r=t._id;return t.each(function(){var i=Q(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return Y(i,r).value[e]}}function Rn(t,e){var n;return(typeof e=="number"?U:e instanceof ct?Gt:(n=ct(e))?(e=n,Gt):$n)(t,e)}function Oa(t){return function(){this.removeAttribute(t)}}function Xa(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ba(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function Va(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function Ua(t,e,n){var r,i,a;return function(){var o,s=n(this),u;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=s+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s)))}}function Ga(t,e,n){var r,i,a;return function(){var o,s=n(this),u;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=s+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s)))}}function Wa(t,e){var n=jt(t),r=n==="transform"?Na:Rn;return this.attrTween(t,typeof e=="function"?(n.local?Ga:Ua)(n,r,Ce(this,"attr."+t,e)):e==null?(n.local?Xa:Oa)(n):(n.local?Va:Ba)(n,r,e))}function Ya(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Ja(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Za(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&Ja(t,a)),n}return i._value=e,i}function Ka(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&Ya(t,a)),n}return i._value=e,i}function Qa(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=jt(t);return this.tween(n,(r.local?Za:Ka)(r,e))}function ja(t,e){return function(){Ee(this,t).delay=+e.apply(this,arguments)}}function to(t,e){return e=+e,function(){Ee(this,t).delay=e}}function eo(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ja:to)(e,t)):Y(this.node(),e).delay}function no(t,e){return function(){Q(this,t).duration=+e.apply(this,arguments)}}function ro(t,e){return e=+e,function(){Q(this,t).duration=e}}function io(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?no:ro)(e,t)):Y(this.node(),e).duration}function ao(t,e){if(typeof e!="function")throw new Error;return function(){Q(this,t).ease=e}}function oo(t){var e=this._id;return arguments.length?this.each(ao(e,t)):Y(this.node(),e).ease}function so(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Q(this,t).ease=n}}function lo(t){if(typeof t!="function")throw new Error;return this.each(so(this._id,t))}function uo(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],u,l=0;l<o;++l)(u=a[l])&&t.call(u,u.__data__,l,a)&&s.push(u);return new rt(r,this._parents,this._name,this._id)}function co(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u=e[s],l=n[s],c=u.length,f=o[s]=new Array(c),h,d=0;d<c;++d)(h=u[d]||l[d])&&(f[d]=h);for(;s<r;++s)o[s]=e[s];return new rt(o,this._parents,this._name,this._id)}function fo(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function ho(t,e,n){var r,i,a=fo(e)?Ee:Q;return function(){var o=a(this,t),s=o.on;s!==r&&(i=(r=s).copy()).on(e,n),o.on=i}}function po(t,e){var n=this._id;return arguments.length<2?Y(this.node(),n).on.on(t):this.each(ho(n,t,e))}function vo(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function go(){return this.on("end.remove",vo(this._id))}function mo(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ae(t));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s=r[o],u=s.length,l=a[o]=new Array(u),c,f,h=0;h<u;++h)(c=s[h])&&(f=t.call(c,c.__data__,h,s))&&("__data__"in c&&(f.__data__=c.__data__),l[h]=f,ee(l[h],e,n,h,l,Y(c,n)));return new rt(a,this._parents,e,n)}function yo(t){var e=this._name,n=this._id;typeof t!="function"&&(t=pn(t));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var u=r[s],l=u.length,c,f=0;f<l;++f)if(c=u[f]){for(var h=t.call(c,c.__data__,f,u),d,v=Y(c,n),m=0,b=h.length;m<b;++m)(d=h[m])&&ee(d,e,n,m,h,v);a.push(h),o.push(c)}return new rt(a,o,e,n)}var _o=Et.prototype.constructor;function wo(){return new _o(this._groups,this._parents)}function xo(t,e){var n,r,i;return function(){var a=mt(this,t),o=(this.style.removeProperty(t),mt(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}function Pn(t){return function(){this.style.removeProperty(t)}}function bo(t,e,n){var r,i=n+"",a;return function(){var o=mt(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}function ko(t,e,n){var r,i,a;return function(){var o=mt(this,t),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(t),mt(this,t))),o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s))}}function Ao(t,e){var n,r,i,a="style."+e,o="end."+a,s;return function(){var u=Q(this,t),l=u.on,c=u.value[a]==null?s||(s=Pn(e)):void 0;(l!==n||i!==c)&&(r=(n=l).copy()).on(o,i=c),u.on=r}}function Mo(t,e,n){var r=(t+="")=="transform"?$a:Rn;return e==null?this.styleTween(t,xo(t,r)).on("end.style."+t,Pn(t)):typeof e=="function"?this.styleTween(t,ko(t,r,Ce(this,"style."+t,e))).each(Ao(this._id,t)):this.styleTween(t,bo(t,r,e),n).on("end.style."+t,null)}function To(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function $o(t,e,n){var r,i;function a(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&To(t,o,n)),r}return a._value=e,a}function No(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,$o(t,e,n??""))}function So(t){return function(){this.textContent=t}}function Eo(t){return function(){var e=t(this);this.textContent=e??""}}function Co(t){return this.tween("text",typeof t=="function"?Eo(Ce(this,"text",t)):So(t==null?"":t+""))}function zo(t){return function(e){this.textContent=t.call(this,e)}}function Io(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&zo(i)),e}return r._value=t,r}function Ro(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Io(t))}function Po(){for(var t=this._name,e=this._id,n=Fn(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,u,l=0;l<s;++l)if(u=o[l]){var c=Y(u,e);ee(u,t,n,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new rt(r,this._parents,t,n)}function Fo(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},u={value:function(){--i===0&&a()}};n.each(function(){var l=Q(this,r),c=l.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),l.on=e}),i===0&&a()})}var Do=0;function rt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Fn(){return++Do}var et=Et.prototype;rt.prototype={constructor:rt,select:mo,selectAll:yo,selectChild:et.selectChild,selectChildren:et.selectChildren,filter:uo,merge:co,selection:wo,transition:Po,call:et.call,nodes:et.nodes,node:et.node,size:et.size,empty:et.empty,each:et.each,on:po,attr:Wa,attrTween:Qa,style:Mo,styleTween:No,text:Co,textTween:Ro,remove:go,tween:qa,delay:eo,duration:io,ease:oo,easeVarying:lo,end:Fo,[Symbol.iterator]:et[Symbol.iterator]};function Ho(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Lo={time:null,delay:0,duration:250,ease:Ho};function qo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Oo(t){var e,n;t instanceof rt?(e=t._id,t=t._name):(e=Fn(),(n=Lo).time=Se(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&ee(u,t,e,l,o,n||qo(u,e));return new rt(r,this._parents,t,e)}Et.prototype.interrupt=Da;Et.prototype.transition=Oo;const we=Math.PI,xe=2*we,st=1e-6,Xo=xe-st;function Dn(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Bo(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Dn;const n=10**e;return function(r){this._+=r[0];for(let i=1,a=r.length;i<a;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class Vo{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?Dn:Bo(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,a,o){this._append`C${+e},${+n},${+r},${+i},${this._x1=+a},${this._y1=+o}`}arcTo(e,n,r,i,a){if(e=+e,n=+n,r=+r,i=+i,a=+a,a<0)throw new Error(`negative radius: ${a}`);let o=this._x1,s=this._y1,u=r-e,l=i-n,c=o-e,f=s-n,h=c*c+f*f;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(h>st)if(!(Math.abs(f*u-l*c)>st)||!a)this._append`L${this._x1=e},${this._y1=n}`;else{let d=r-o,v=i-s,m=u*u+l*l,b=d*d+v*v,N=Math.sqrt(m),T=Math.sqrt(h),A=a*Math.tan((we-Math.acos((m+h-b)/(2*N*T)))/2),R=A/T,g=A/N;Math.abs(R-1)>st&&this._append`L${e+R*c},${n+R*f}`,this._append`A${a},${a},0,0,${+(f*d>c*v)},${this._x1=e+g*u},${this._y1=n+g*l}`}}arc(e,n,r,i,a,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let s=r*Math.cos(i),u=r*Math.sin(i),l=e+s,c=n+u,f=1^o,h=o?i-a:a-i;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>st||Math.abs(this._y1-c)>st)&&this._append`L${l},${c}`,r&&(h<0&&(h=h%xe+xe),h>Xo?this._append`A${r},${r},0,1,${f},${e-s},${n-u}A${r},${r},0,1,${f},${this._x1=l},${this._y1=c}`:h>st&&this._append`A${r},${r},0,${+(h>=we)},${f},${this._x1=e+r*Math.cos(a)},${this._y1=n+r*Math.sin(a)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}var Ze={},se={},le=34,bt=10,ue=13;function Hn(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function Uo(t,e){var n=Hn(t);return function(r,i){return e(n(r),i,t)}}function Ke(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function L(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function Go(t){return t<0?"-"+L(-t,6):t>9999?"+"+L(t,6):L(t,4)}function Wo(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Go(t.getUTCFullYear())+"-"+L(t.getUTCMonth()+1,2)+"-"+L(t.getUTCDate(),2)+(i?"T"+L(e,2)+":"+L(n,2)+":"+L(r,2)+"."+L(i,3)+"Z":r?"T"+L(e,2)+":"+L(n,2)+":"+L(r,2)+"Z":n||e?"T"+L(e,2)+":"+L(n,2)+"Z":"")}function Yo(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(f,h){var d,v,m=i(f,function(b,N){if(d)return d(b,N-1);v=b,d=h?Uo(b,h):Hn(b)});return m.columns=v||[],m}function i(f,h){var d=[],v=f.length,m=0,b=0,N,T=v<=0,A=!1;f.charCodeAt(v-1)===bt&&--v,f.charCodeAt(v-1)===ue&&--v;function R(){if(T)return se;if(A)return A=!1,Ze;var _,w=m,x;if(f.charCodeAt(w)===le){for(;m++<v&&f.charCodeAt(m)!==le||f.charCodeAt(++m)===le;);return(_=m)>=v?T=!0:(x=f.charCodeAt(m++))===bt?A=!0:x===ue&&(A=!0,f.charCodeAt(m)===bt&&++m),f.slice(w+1,_-1).replace(/""/g,'"')}for(;m<v;){if((x=f.charCodeAt(_=m++))===bt)A=!0;else if(x===ue)A=!0,f.charCodeAt(m)===bt&&++m;else if(x!==n)continue;return f.slice(w,_)}return T=!0,f.slice(w,v)}for(;(N=R())!==se;){for(var g=[];N!==Ze&&N!==se;)g.push(N),N=R();h&&(g=h(g,b++))==null||d.push(g)}return d}function a(f,h){return f.map(function(d){return h.map(function(v){return c(d[v])}).join(t)})}function o(f,h){return h==null&&(h=Ke(f)),[h.map(c).join(t)].concat(a(f,h)).join(`
`)}function s(f,h){return h==null&&(h=Ke(f)),a(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(t)}function c(f){return f==null?"":f instanceof Date?Wo(f):e.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:s,formatRows:u,formatRow:l,formatValue:c}}var Jo=Yo(","),Zo=Jo.parse;function Ko(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function Qo(t,e){return fetch(t,e).then(Ko)}function jo(t){return function(e,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=void 0),Qo(e,n).then(function(i){return t(i,r)})}}var ts=jo(Zo);function es(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Zt(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function _t(t){return t=Zt(Math.abs(t)),t?t[1]:NaN}function ns(t,e){return function(n,r){for(var i=n.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(n.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(e)}}function rs(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var is=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Kt(t){if(!(e=is.exec(t)))throw new Error("invalid format: "+t);var e;return new ze({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Kt.prototype=ze.prototype;function ze(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ze.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function as(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var Ln;function os(t,e){var n=Zt(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(Ln=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Zt(t,Math.max(0,e+a-1))[0]}function Qe(t,e){var n=Zt(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const je={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:es,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Qe(t*100,e),r:Qe,s:os,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function tn(t){return t}var en=Array.prototype.map,nn=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ss(t){var e=t.grouping===void 0||t.thousands===void 0?tn:ns(en.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?tn:rs(en.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function l(f){f=Kt(f);var h=f.fill,d=f.align,v=f.sign,m=f.symbol,b=f.zero,N=f.width,T=f.comma,A=f.precision,R=f.trim,g=f.type;g==="n"?(T=!0,g="g"):je[g]||(A===void 0&&(A=12),R=!0,g="g"),(b||h==="0"&&d==="=")&&(b=!0,h="0",d="=");var _=m==="$"?n:m==="#"&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",w=m==="$"?r:/[%p]/.test(g)?o:"",x=je[g],S=/[defgprs%]/.test(g);A=A===void 0?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function F(y){var D=_,z=w,j,wt,at;if(g==="c")z=x(y)+z,y="";else{y=+y;var tt=y<0||1/y<0;if(y=isNaN(y)?u:x(Math.abs(y),A),R&&(y=as(y)),tt&&+y==0&&v!=="+"&&(tt=!1),D=(tt?v==="("?v:s:v==="-"||v==="("?"":v)+D,z=(g==="s"?nn[8+Ln/3]:"")+z+(tt&&v==="("?")":""),S){for(j=-1,wt=y.length;++j<wt;)if(at=y.charCodeAt(j),48>at||at>57){z=(at===46?i+y.slice(j+1):y.slice(j))+z,y=y.slice(0,j);break}}}T&&!b&&(y=e(y,1/0));var ot=D.length+y.length+z.length,X=ot<N?new Array(N-ot+1).join(h):"";switch(T&&b&&(y=e(X+y,X.length?N-z.length:1/0),X=""),d){case"<":y=D+y+z+X;break;case"=":y=D+X+y+z;break;case"^":y=X.slice(0,ot=X.length>>1)+D+y+z+X.slice(ot);break;default:y=X+D+y+z;break}return a(y)}return F.toString=function(){return f+""},F}function c(f,h){var d=l((f=Kt(f),f.type="f",f)),v=Math.max(-8,Math.min(8,Math.floor(_t(h)/3)))*3,m=Math.pow(10,-v),b=nn[8+v/3];return function(N){return d(m*N)+b}}return{format:l,formatPrefix:c}}var Dt,qn,On;ls({thousands:",",grouping:[3],currency:["$",""]});function ls(t){return Dt=ss(t),qn=Dt.format,On=Dt.formatPrefix,Dt}function us(t){return Math.max(0,-_t(Math.abs(t)))}function cs(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_t(e)/3)))*3-_t(Math.abs(t)))}function fs(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,_t(e)-_t(t))+1}function hs(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function ds(t){return function(){return t}}function ps(t){return+t}var rn=[0,1];function vt(t){return t}function be(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:ds(isNaN(e)?NaN:.5)}function vs(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function gs(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=be(i,r),a=n(o,a)):(r=be(r,i),a=n(a,o)),function(s){return a(r(s))}}function ms(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=be(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(s){var u=hr(t,s,1,r)-1;return a[u](i[u](s))}}function ys(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function _s(){var t=rn,e=rn,n=Ne,r,i,a,o=vt,s,u,l;function c(){var h=Math.min(t.length,e.length);return o!==vt&&(o=vs(t[0],t[h-1])),s=h>2?ms:gs,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?a:(u||(u=s(t.map(r),e,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=s(e,t.map(r),U)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,ps),c()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),c()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=Aa,c()},f.clamp=function(h){return arguments.length?(o=h?!0:vt,c()):o!==vt},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(a=h,f):a},function(h,d){return r=h,i=d,c()}}function ws(){return _s()(vt,vt)}function xs(t,e,n,r){var i=mr(t,e,n),a;switch(r=Kt(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=cs(i,o))&&(r.precision=a),On(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=fs(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=us(i))&&(r.precision=a-(r.type==="%")*2);break}}return qn(r)}function bs(t){var e=t.domain;return t.ticks=function(n){var r=e();return gr(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return xs(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,o=r[i],s=r[a],u,l,c=10;for(s<o&&(l=o,o=s,s=l,l=i,i=a,a=l);c-- >0;){if(l=he(o,s,n),l===u)return r[i]=o,r[a]=s,e(r);if(l>0)o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l;else if(l<0)o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l;else break;u=l}return t},t}function ke(){var t=ws();return t.copy=function(){return ys(t,ke())},hs.apply(t,arguments),bs(t)}function ht(t){return function(){return t}}function ks(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Vo(e)}function As(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Xn(t){this._context=t}Xn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Ms(t){return new Xn(t)}function Ts(t){return t[0]}function $s(t){return t[1]}function Ns(t,e){var n=ht(!0),r=null,i=Ms,a=null,o=ks(s);t=typeof t=="function"?t:t===void 0?Ts:ht(t),e=typeof e=="function"?e:e===void 0?$s:ht(e);function s(u){var l,c=(u=As(u)).length,f,h=!1,d;for(r==null&&(a=i(d=o())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===h&&((h=!h)?a.lineStart():a.lineEnd()),h&&a.point(+t(f,l,u),+e(f,l,u));if(d)return a=null,d+""||null}return s.x=function(u){return arguments.length?(t=typeof u=="function"?u:ht(+u),s):t},s.y=function(u){return arguments.length?(e=typeof u=="function"?u:ht(+u),s):e},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:ht(!!u),s):n},s.curve=function(u){return arguments.length?(i=u,r!=null&&(a=i(r)),s):i},s.context=function(u){return arguments.length?(u==null?r=a=null:a=i(r=u),s):r},s}function Tt(t,e,n){this.k=t,this.x=e,this.y=n}Tt.prototype={constructor:Tt,scale:function(t){return t===1?this:new Tt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Tt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Tt.prototype;var Ss=K('<div class="legend-item svelte-4o8g80"><svg width="24" height="12" viewBox="0 0 24 12" class="svelte-4o8g80"><path d="M0,6 L24,6" stroke-width="3" fill="none"></path></svg> <span class="legend-text svelte-4o8g80"> </span></div>'),Es=Qt('<line stroke="#333" stroke-width="1"></line><text fill="#fff" text-anchor="end" dominant-baseline="middle" class="svelte-4o8g80"> </text>',1),Cs=Qt('<line stroke="#333" stroke-width="1"></line><text fill="#fff" text-anchor="middle" class="svelte-4o8g80"> </text>',1),zs=Qt('<path fill="none" stroke-width="3"></path>'),Is=Qt('<text fill="#fff" text-anchor="middle" transform="rotate(-90, 10, 200)" class="y-axis-title svelte-4o8g80"> </text>'),Rs=K('<div class="chart-container svelte-4o8g80"><h2 class="svelte-4o8g80"> </h2> <div class="legend-container svelte-4o8g80"></div> <svg height="400"><rect height="400" fill="#000"></rect><!><!><!><!></svg></div>');function kt(t,e){an(e,!1);let n=nt(e,"path_to_data",8,""),r=nt(e,"title",8,""),i=nt(e,"yticks",24,()=>[]),a=nt(e,"y_axis_title",8,""),o=J(750),s=J([]),u=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],l=["#8DBF2E","#00A189","#6FC7EA","#007FA3","#AB1368","#DC4633","#F1C500"];cn(()=>{const g=()=>{const _=document.querySelector(".chart-container");_&&H(o,Math.min(p(o),_.parentElement.clientWidth))};return g(),window.addEventListener("resize",g),ts(n()).then(_=>{H(s,_.map(w=>{const x={Hour:+w.Hour};return u.forEach(S=>x[S]=+w[S]),x}))}),()=>window.removeEventListener("resize",g)});let c=J();ce(()=>(p(s),p(o),Un(i())),()=>{if(p(s).length>0){const g=ke().domain([0,23]).range([50,p(o)-20]),_=ke().domain([_r(i()),yr(i())]).range([360,40]),w=Ns().x(y=>g(y.Hour)).y(y=>_(y.value)),x=u.map(y=>{const D=y==="Saturday"||y==="Sunday";return{day:y,path:w(p(s).map(z=>({Hour:z.Hour,value:z[y]}))),color:l[u.indexOf(y)],isDashed:D}}),S=Array.from({length:24},(y,D)=>D),F=[...i()];H(c,{x:g,y:_,lines:x,xTicks:S,yTicks:F})}}),on(),un();var f=Rs(),h=C(f),d=C(h,!0);M(h);var v=$(h,2);dt(v,5,()=>{var g;return(g=p(c))==null?void 0:g.lines},pt,(g,_)=>{var w=Ss(),x=C(w),S=C(x);M(x);var F=$(x,2),y=C(F,!0);M(F),M(w),P(()=>{k(S,"stroke",p(_).color),k(S,"stroke-dasharray",p(_).isDashed?"4,2":"0"),it(y,p(_).day)}),q(g,w)}),M(v);var m=$(v,2),b=C(m),N=$(b);dt(N,1,()=>{var g;return(g=p(c))==null?void 0:g.yTicks},pt,(g,_)=>{var w=Es(),x=fe(w);k(x,"x1",50),P(()=>k(x,"y1",p(c).y(p(_)))),P(()=>k(x,"y2",p(c).y(p(_))));var S=$(x);k(S,"x",45),P(()=>k(S,"y",p(c).y(p(_))));var F=C(S,!0);M(S),P(()=>{k(x,"x2",p(o)-20),it(F,p(_))}),q(g,w)});var T=$(N);dt(T,1,()=>{var g;return(g=p(c))==null?void 0:g.xTicks},pt,(g,_)=>{var w=Cs(),x=fe(w);P(()=>k(x,"x1",p(c).x(p(_)))),k(x,"y1",360),P(()=>k(x,"x2",p(c).x(p(_)))),k(x,"y2",40);var S=$(x);P(()=>k(S,"x",p(c).x(p(_)))),k(S,"y",375);var F=C(S,!0);M(S),P(()=>it(F,p(_))),q(g,w)});var A=$(T);dt(A,1,()=>{var g;return(g=p(c))==null?void 0:g.lines},pt,(g,_)=>{var w=zs();P(()=>{k(w,"d",p(_).path),k(w,"stroke",p(_).color),k(w,"stroke-dasharray",p(_).isDashed?"4,2":"0")}),q(g,w)});var R=$(A);ln(R,a,g=>{var _=Is();k(_,"x",15),k(_,"y",205);var w=C(_,!0);M(_),P(()=>it(w,a())),q(g,_)}),M(m),M(f),P(()=>{k(f,"style",`width: ${p(o)??""}px; height: 450px;`),it(d,r()),k(m,"width",p(o)),k(m,"viewBox",`0 0 ${p(o)} 400`),k(b,"width",p(o))}),q(t,f),sn()}const Ps=""+new URL("../assets/top-image.JUTWmls1.png",import.meta.url).href;var Fs=K('<meta name="description" content="Exploring daily and hourly activity patterns in Toronto via charts and animated maps"> <meta name="author" content="Cameron Kerr, Julia Greenberg, Jeff Allen"> <meta property="og:title" content="Activity Patterns Greater Toronto Area | School of Cities"> <meta property="og:description" content="Exploring daily and hourly activity patterns in Toronto via charts and animated maps"> <meta property="og:type" content="website"> <meta property="og:url" content="https://schoolofcities.github.io/urban-activity-atlas/exploring-hourly-activity-toronto"> <meta property="og:image" content="https://schoolofcities.github.io/urban-activity-atlas/web-card-gta-activity.png"> <meta property="og:locale" content="en_CA"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="https://schoolofcities.github.io/urban-activity-atlas/exploring-hourly-activity-toronto"> <meta name="twitter:creator" content="@UofTCities"> <meta name="twitter:title" content="Activity Patterns Greater Toronto Area | School of Cities"> <meta name="twitter:description" content="Exploring daily and hourly activity patterns in Toronto via charts and animated maps"> <meta name="twitter:image" content="https://schoolofcities.github.io/urban-activity-atlas/web-card-gta-activity.png">',1),Ds=K(`<!> <main class="svelte-uz1plv"><div class="title svelte-uz1plv"><img alt="" class="svelte-uz1plv"> <h1 class="svelte-uz1plv">Exploring hourly activity patterns in Toronto</h1> <p id="authors" class="svelte-uz1plv"><a href="https://camhkerr.com/" target="_blank" class="svelte-uz1plv">Cameron Kerr</a>, <a href="https://www.urbandisplacement.org/team/julia-greenberg/" target="_blank" class="svelte-uz1plv">Julia Greenberg</a>, <a href="https://jamaps.github.io/" target="_blank" class="svelte-uz1plv">Jeff Allen</a> |
		June 2025</p></div> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Metropolitan regions are constantly changing, complex systems. As their inhabitants and visitors commute between home and work, run
		errands, and engage in other activities, regions develop their own unique pulse and rhythm.</p> <p class="svelte-uz1plv">The following visualizations illustrate this movement throughout the Greater Toronto Area (GTA)a region with 
		almost 7 million people and a mix of urban, rural, and suburban communitiesat different hours of the day using data collected 
		from mobile devices.</p> <p class="svelte-uz1plv">To do so, we selected over 16,000 grid cells, each about 1 kilometer wide, across the GTA. For each of these grid cells, we measured hourly activity by calculating the <i>accumulated time</i> that a sample of mobile devices (i.e., cell phones) spent in each grid 
		cell. For example, if two mobile devices each spent 30 minutes of a given hour in a given cell, the region would be assigned an 
		accumulated time of 1 for that hour. The sample of mobile device location data was provided by <a href="https://cuebiq.com/social-impact/" target="_blank" class="svelte-uz1plv">Cuebiq</a>.</p> <p class="svelte-uz1plv">We then mapped the results and calculated statistics summarizing the patterns that we observed.</p> <p class="svelte-uz1plv">The first map below shows the total accumulated time for each hour (shown using the 24 hour clock) of the average weekday and weekend in the summer of 2024 in the GTA. There isn't much fluctuation, demonstrating that the spatial distribution of total hourly activity is relatively constant. Activity at all hours during both types of days is consistently concentrated in specific locations (e.g. downtown Toronto)</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">However, the map does reveal some interesting trends when looking closely. In the region overall, there is less activity at night.
		There is also a notable dark area on the map where the Pearson International Airport is located, indicating that there is
		generally less activity there compared to other parts of the region at night.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">The plot above shows the number of active devices in the sample during each hour throughout the week. The observed drop could be 
		due to the nature of the device location data, as lower overall levels of movement at night may result in fewer instances of devices' 
		locations being collected by the data provider. Another factor could be commuters coming into the GTA to work during the day and 
		leaving the region at night.</p> <p class="svelte-uz1plv">In the map shown above, the underlying population density of the region distribution obscures hourly changes in activity. 
		In other words, since there are almost always more people in the city of Toronto (especially downtown) than anywhere else in the region, the spatial distribution of overall activity levels always looks fairly similar.</p> <p class="svelte-uz1plv">To better illustrate <i>relative</i> changes in activity, the map below shows the difference between each individual cell's hourly 
		activity and its <i>average</i> hourly activity throughout the summer of 2024. This new metric
		measures how much more or less activity occurs in a given cell compared to the typical level of activity in that cell.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Patterns of movement throughout the region are much more pronounced in this version of the map. This map reveals that people cluster in employment centers during weekdays and then become more dispersed during weekday evenings. For example, the southeastern part of 
		Brampton and northeastern Mississauga is a massive employment area that becomes busier than usual during weekday working hours. During weekday evenings, on the other hand, the more residential northern and western parts of Brampton experience higher than average activity.</p> <p class="svelte-uz1plv">This trend of increased activity in employment zones during weekday working hours is prevalent throughout the GTA, including
		in the southern part of Vaughan, parts of Markham, and in downtown Toronto. Areas that mostly consist of residential buildings (rather than retail and commercial) have more activity in the evenings. Commuting patterns are also highlighted in the weekday version of the map, as activity visibly increases between 3 pm and 6 pm on Highway 400, Highway 401, and the QEW.</p> <p class="svelte-uz1plv">Spatial patterns during the weekend are somewhat similar to weekday patterns, with some key differences. While weekday activity
		generally begins around 7 am, especially in the northwest part of the region and around the airport, on weekends
		there is still low overall activity at this time. Weekend activity picks up a few hours later, around 10 or 11 am.</p> <p class="svelte-uz1plv">Activity during the day is also more evenly spread out throughout the region on weekends, and does not concentrate in major 
		employment areas like on weekdays. During both weekends and weekdays, however, activity in the central part of the city 
		of Toronto increases significantly around 10 or 11 pm.</p> <h2 class="svelte-uz1plv">Diversity and clustering</h2> <p class="svelte-uz1plv">Diversity and clustering statistics were used to quantify the daily patterns observed in the maps above. <a href="https://en.wikipedia.org/wiki/Diversity_index#Shannon_index" target="_blank" class="svelte-uz1plv">Shannon's Diversity 
		Index</a> captures both <i>richness</i> (the number of grid cells on the map with activity) and <i>evenness</i> (how evenly that 
		activity is distributed among them).</p> <p class="svelte-uz1plv">A high Shannon Index means that many cells have activity and that activity levels are relatively balanced across them. In contrast, 
		a low Shannon Index suggests that fewer cells are experiencing activity and that activity is concentrated in specific cells.</p> <p class="svelte-uz1plv">Note that this index is "spatially unaware". In other words, if all the cells were shuffled into different positions on the map, the 
		Shannon index value would remain the same.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">The plot above shows that activity becomes more <i>spatially diverse</i> during daytime hours, peaking between 3 pm and 5 pm, and then decreases in the evening and remains low throughout the night. Although differences in the actual index values are relatively small, an <a href="https://search.r-project.org/CRAN/refmans/ARTool/html/art.html" target="_blank" class="svelte-uz1plv">Aligned Rank Transform (ART) ANOVA</a> test confirmed that the variation in diversity between day and night is statistically 
		significant.</p> <p class="svelte-uz1plv">One possible explanation is that during the day, people are more mobile and spend less time staying fixed in specific locations
		relative to evenings, especially during commuting hours (when diversity peaks). The diversity index also increases slightly later in 
		the day on weekends compared to weekdays, likely corresponding with non-work weekend routines.</p> <p class="svelte-uz1plv">As mentioned above, Shannon's Index reflects both <i>richness</i> and <i>evenness</i>. To better understand each component's 
		contribution to diversity, they were examined seperately. Richness, in this case, represents the number of cells in the GTA that 
		are visited within a given hour. Evenness indicates the degree to which activity is uniformly distributed throughout the region.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Richness (the proportion of grid cells experiencing activity) reveals a pattern similar to Shannon's Diversity Index. During the day, 
		more people are moving around, generating activity in a large number of cells. At night, activity becomes concentrated in 
		residential areas, leaving roughly half of the cells inactive.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Evenness (how evenly activity is spread out throughout the region) follows a reverse pattern. It generally 
		spikes at night around 3 am and gradually decreases during the day, likely reflecting the transition from home to more concentrated areas of work and leisure.</p> <p class="svelte-uz1plv">Evenness also increases again slightly on weekdays between 3 pm and 5 pm, most likely a result of commuters spreading out throughout the GTA as they leave work.</p> <p class="svelte-uz1plv">In addition to diversity indices, clustering was calculated using the <a href="https://en.wikipedia.org/wiki/Moran%27s_I" target="_blank" class="svelte-uz1plv">Moran's I</a> statistic for each hour throughout the week. A high, positive (between 0 and +1) Morans I value indicates that cells with similar activity are geographically close to each other, suggesting strong spatial autocorrelation. A value near zero suggests that activity levels are randomly distributed across space. A low negative value (between 0 and -1) indicates that high-activity cells are typically surrounded by low-activity cells and vice versa.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">The plot above reveals that activity is more spatially concentrated during the day, especially in late afternoons, compared to 
		evenings and nights, when activity is more dispersed. This clustering trend is relatively similar to the trends for diversity and
		richness.</p> <p class="svelte-uz1plv">However, one noticeable difference is that the clustering plot shows a larger disparity between weekends and weekdays compared
		to the diversity and richness plots. On Saturdays and especially Sundays, there is less spatial clustering during the day compared to
		weekdays.</p> <p class="svelte-uz1plv">In other words, on weekend mornings and afternoons, there is a similar, even slightly higher proportion of grid cells with activity compared to weekday mornings and afternoons. However, the places where people spend time on weekend mornings and afternoons are less spatially concentrated. This makes sense, given that employment centers tend to be in specific areas whereas leisure activities are generally more spread out.</p></div></main>`,1);function Gs(t){var e=Ds();Wn(d=>{var v=Fs();Gn.title="Activity Patterns Greater Toronto Area | School of Cities",re(26),q(d,v)});var n=fe(e);nr(n);var r=$(n,2),i=C(r),a=C(i);k(a,"src",Ps),re(4),M(i);var o=$(i,4);Re(o,{title:"Mean hourly activity in Toronto",folder_weekday:"exploring-hourly-activity-toronto/Weekday_Total_small",folder_weekend:"exploring-hourly-activity-toronto/Weekend_Total_small",legendColors:["#331d33","#c53e2e","#eddd53"],legendLabels:["Few active mobile devices","Many active mobile devices"]});var s=$(o,4);kt(s,{path_to_data:"exploring-hourly-activity-toronto/data/pings_normalized.csv",title:"Hourly activity in Toronto by day of the week",yticks:[.5,.75,1,1.25,1.5],y_axis_title:"Mean normalized hourly activity"});var u=$(s,4);Re(u,{title:"Mean-subtracted hourly activity in Toronto",folder_weekday:"exploring-hourly-activity-toronto/Weekday_Difference_small",folder_weekend:"exploring-hourly-activity-toronto/Weekend_Difference_small",legendColors:["#d0f9ff","#4ca4c3","#331d33","#c53e2e","#eddd53"],legendLabels:["Relatively low activity","Mean activity","Relatively high activity"]});var l=$(u,4);kt(l,{path_to_data:"exploring-hourly-activity-toronto/data/shannon.csv",title:"Shannon diversity index of hourly activity in Toronto",yticks:[7.9,8,8.1,8.2],y_axis_title:""});var c=$(l,4);kt(c,{path_to_data:"exploring-hourly-activity-toronto/data/richness.csv",title:"Proportion of cells with activity throughout the day",yticks:[.4,.5,.6,.7],y_axis_title:"Richness"});var f=$(c,4);kt(f,{path_to_data:"exploring-hourly-activity-toronto/data/evenness.csv",title:"Evenness of activity throughout the day",yticks:[.86,.87,.88,.89,.9],y_axis_title:"Evenness"});var h=$(f,4);kt(h,{path_to_data:"exploring-hourly-activity-toronto/data/moran.csv",title:"Spatial clustering of hourly activity in Toronto",yticks:[.34,.38,.42,.46],y_axis_title:"Moran's I of hourly activity in Toronto"}),re(2),M(r),q(t,e)}export{Gs as component,Us as universal};
