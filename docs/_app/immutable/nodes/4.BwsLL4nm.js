import{a as B,t as rt,n as Qt}from"../chunks/disclose-version.DGdhgyke.js";import{s as C,v as M,p as an,aC as ue,aD as on,t as F,o as sn,g as p,$ as L,w as N,aE as Z,ai as Vn,m as ce,e as Un,aF as Ie}from"../chunks/runtime.BZKQqjz2.js";import{s as k,l as Wn,e as dt,b as Yn,h as Gn,c as Zn,i as pt,r as Jn,t as re}from"../chunks/top-logo-full.BdX9ClYW.js";import{e as It,s as it}from"../chunks/render.CPk_Rj9m.js";import{p as et,i as ln}from"../chunks/props.B_Fx1jNj.js";import{i as un}from"../chunks/lifecycle.xsc8TNuo.js";import{o as cn,a as Kn}from"../chunks/index-client.kG3SwSxu.js";const Qn=!0,Xs=Object.freeze(Object.defineProperty({__proto__:null,prerender:Qn},Symbol.toStringTag,{value:"Module"}));var jn=rt('<div id="bar" class="svelte-os6al8"><div id="logo" class="svelte-os6al8"><a href="https://www.schoolofcities.utoronto.ca/" class="svelte-os6al8"><img alt="School of Cities" class="svelte-os6al8"></a></div></div>');function tr(t){var e=jn(),n=C(e),r=C(n),i=C(r);k(i,"src",Wn),M(r),M(n),M(e),B(t,e)}var er=rt("<span> </span>"),nr=rt('<button aria-label="Play" class="svelte-14u9mog"><svg width="12" height="12" viewBox="0 0 12 12" fill="white" xmlns="http://www.w3.org/2000/svg"><polygon points="2,1 10,6 2,11"></polygon></svg></button>'),rr=rt('<button aria-label="Stop" class="svelte-14u9mog"><svg width="12" height="12" viewBox="0 0 12 12" fill="white" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="8" height="8"></rect></svg></button>'),ir=rt('<span class="svelte-14u9mog"> </span>'),ar=rt('<div class="container svelte-14u9mog"><h3 class="svelte-14u9mog"> </h3> <div class="legend-container svelte-14u9mog"><div class="gradient-legend svelte-14u9mog"></div> <div class="legend-labels svelte-14u9mog"></div></div> <div class="controls svelte-14u9mog"><div class="range-play-wrapper svelte-14u9mog"><!> <div class="slider-wrapper svelte-14u9mog"><input type="range" min="0" max="23" step="1" class="custom-slider svelte-14u9mog"> <div class="ticks svelte-14u9mog"></div></div></div></div> <div class="mode-toggle svelte-14u9mog"><button class="svelte-14u9mog">Weekday</button> <button class="svelte-14u9mog">Weekend</button></div> <img loading="lazy" decoding="async" class="svelte-14u9mog"></div>');function Re(t,e){an(e,!1);const n=Z(),r=Z();let i=et(e,"title",8,""),a=et(e,"folder_weekday",8,""),o=et(e,"folder_weekend",8,""),s=et(e,"legendColors",24,()=>[]),u=et(e,"legendLabels",24,()=>[]),l=Z(),c=Z(0),f=null,h=Z(!1),d=Z(!1),v=[],m=Z("weekday");function b(E){E==="weekday"?L(l,a()):L(l,o()),L(m,E),A()}function T(E){"requestIdleCallback"in window?requestIdleCallback(E,{timeout:2e3}):setTimeout(E,100)}async function $(E){return new Promise(I=>{const V=new Image;V.src=E,V.decoding="async";let X=!1;V.onload=()=>{X||(v.push(E),X=!0,I())},V.onerror=()=>{X||(X=!0,I())},V.decode&&V.decode().then(()=>{X||(v.push(E),X=!0,I())}).catch(()=>{})})}async function A(){L(d,!1),v=[],await $(p(n)[0]),setTimeout(async()=>{await Promise.all([$(p(n)[1]),$(p(n)[2]),$(p(n)[3])])},50),p(n).slice(4).forEach(E=>{T(()=>$(E))}),L(d,!0)}cn(()=>{b("weekday")}),Kn(()=>{clearInterval(f)});function R(){!p(h)&&p(d)&&(L(h,!0),f=setInterval(()=>{L(c,(p(c)+1)%24)},250))}function g(){L(h,!1),clearInterval(f)}ue(()=>p(l),()=>{L(n,Array.from({length:24},(E,I)=>`/urban-activity-atlas/${p(l)}/Hour_${I}.png`))}),ue(()=>{},()=>{L(r,Array.from({length:24},(E,I)=>I))}),on(),un();var _=ar(),w=C(_),x=C(w,!0);M(w);var S=N(w,2),D=C(S);const y=Vn(()=>`background: linear-gradient(to right, ${s().join(",")??""})`);var P=N(D,2);dt(P,5,u,pt,(E,I,V)=>{var X=er();Zn(X,`label-${V??""} svelte-14u9mog`);var Bn=C(X,!0);M(X),F(()=>it(Bn,p(I))),B(E,X)}),M(P),M(S);var z=N(S,2),Q=C(z),wt=C(Q);ln(wt,()=>!p(h),E=>{var I=nr();F(()=>I.disabled=!p(d)),It("click",I,R),B(E,I)},E=>{var I=rr();It("click",I,g),B(E,I)});var at=N(wt,2),j=C(at);Jn(j);var ot=N(j,2);dt(ot,5,()=>p(r),pt,(E,I)=>{var V=ir(),X=C(V,!0);M(V),F(()=>it(X,p(I))),B(E,V)}),M(ot),M(at),M(Q),M(z);var O=N(z,2),ne=C(O),ze=N(ne,2);M(O);var zt=N(O,2);M(_),F(()=>{it(x,i()),k(D,"style",p(y)),j.disabled=!p(d),re(ne,"selected",p(m)==="weekday"),re(ze,"selected",p(m)==="weekend"),k(zt,"src",p(d)?p(n)[p(c)]:"/urban-activity-atlas/exploring-hourly-activity-toronto/blank-image.png"),k(zt,"alt",`Hour ${p(c)}`),re(zt,"loading",!p(d))}),Yn(j,()=>p(c),E=>L(c,E)),It("click",ne,()=>b("weekday")),It("click",ze,()=>b("weekend")),Gn(zt),B(t,_),sn()}function Lt(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function or(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function fn(t){let e,n,r;t.length!==2?(e=Lt,n=(s,u)=>Lt(t(s),u),r=(s,u)=>t(s)-u):(e=t===Lt||t===or?t:sr,n=t,r=t);function i(s,u,l=0,c=s.length){if(l<c){if(e(u,u)!==0)return c;do{const f=l+c>>>1;n(s[f],u)<0?l=f+1:c=f}while(l<c)}return l}function a(s,u,l=0,c=s.length){if(l<c){if(e(u,u)!==0)return c;do{const f=l+c>>>1;n(s[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(s,u,l=0,c=s.length){const f=i(s,u,l,c-1);return f>l&&r(s[f-1],u)>-r(s[f],u)?f-1:f}return{left:i,center:o,right:a}}function sr(){return 0}function lr(t){return t===null?NaN:+t}const ur=fn(Lt),cr=ur.right;fn(lr).center;const fr=Math.sqrt(50),hr=Math.sqrt(10),dr=Math.sqrt(2);function Xt(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=fr?10:a>=hr?5:a>=dr?2:1;let s,u,l;return i<0?(l=Math.pow(10,-i)/o,s=Math.round(t*l),u=Math.round(e*l),s/l<t&&++s,u/l>e&&--u,l=-l):(l=Math.pow(10,i)*o,s=Math.round(t/l),u=Math.round(e/l),s*l<t&&++s,u*l>e&&--u),u<s&&.5<=n&&n<2?Xt(t,e,n*2):[s,u,l]}function pr(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,o]=r?Xt(e,t,n):Xt(t,e,n);if(!(a>=i))return[];const s=a-i+1,u=new Array(s);if(r)if(o<0)for(let l=0;l<s;++l)u[l]=(a-l)/-o;else for(let l=0;l<s;++l)u[l]=(a-l)*o;else if(o<0)for(let l=0;l<s;++l)u[l]=(i+l)/-o;else for(let l=0;l<s;++l)u[l]=(i+l)*o;return u}function fe(t,e,n){return e=+e,t=+t,n=+n,Xt(t,e,n)[2]}function vr(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?fe(e,t,n):fe(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function gr(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function mr(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}var yr={value:()=>{}};function hn(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Ht(n)}function Ht(t){this._=t}function _r(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Ht.prototype=hn.prototype={constructor:Ht,on:function(t,e){var n=this._,r=_r(t+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(t=r[a]).type)&&(i=wr(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(i=(t=r[a]).type)n[i]=Fe(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Fe(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ht(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function wr(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Fe(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=yr,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var he="http://www.w3.org/1999/xhtml";const De={svg:"http://www.w3.org/2000/svg",xhtml:he,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function jt(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),De.hasOwnProperty(e)?{space:De[e],local:t}:t}function xr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===he&&e.documentElement.namespaceURI===he?e.createElement(t):e.createElementNS(n,t)}}function br(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function dn(t){var e=jt(t);return(e.local?br:xr)(e)}function kr(){}function ke(t){return t==null?kr:function(){return this.querySelector(t)}}function Ar(t){typeof t!="function"&&(t=ke(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=new Array(o),u,l,c=0;c<o;++c)(u=a[c])&&(l=t.call(u,u.__data__,c,a))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new Y(r,this._parents)}function Mr(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function $r(){return[]}function pn(t){return t==null?$r:function(){return this.querySelectorAll(t)}}function Nr(t){return function(){return Mr(t.apply(this,arguments))}}function Tr(t){typeof t=="function"?t=Nr(t):t=pn(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o=e[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&(r.push(t.call(u,u.__data__,l,o)),i.push(u));return new Y(r,i)}function vn(t){return function(){return this.matches(t)}}function gn(t){return function(e){return e.matches(t)}}var Sr=Array.prototype.find;function Er(t){return function(){return Sr.call(this.children,t)}}function Cr(){return this.firstElementChild}function zr(t){return this.select(t==null?Cr:Er(typeof t=="function"?t:gn(t)))}var Ir=Array.prototype.filter;function Rr(){return Array.from(this.children)}function Fr(t){return function(){return Ir.call(this.children,t)}}function Dr(t){return this.selectAll(t==null?Rr:Fr(typeof t=="function"?t:gn(t)))}function Pr(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],u,l=0;l<o;++l)(u=a[l])&&t.call(u,u.__data__,l,a)&&s.push(u);return new Y(r,this._parents)}function mn(t){return new Array(t.length)}function Lr(){return new Y(this._enter||this._groups.map(mn),this._parents)}function Bt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Bt.prototype={constructor:Bt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Hr(t){return function(){return t}}function qr(t,e,n,r,i,a){for(var o=0,s,u=e.length,l=a.length;o<l;++o)(s=e[o])?(s.__data__=a[o],r[o]=s):n[o]=new Bt(t,a[o]);for(;o<u;++o)(s=e[o])&&(i[o]=s)}function Or(t,e,n,r,i,a,o){var s,u,l=new Map,c=e.length,f=a.length,h=new Array(c),d;for(s=0;s<c;++s)(u=e[s])&&(h[s]=d=o.call(u,u.__data__,s,e)+"",l.has(d)?i[s]=u:l.set(d,u));for(s=0;s<f;++s)d=o.call(t,a[s],s,a)+"",(u=l.get(d))?(r[s]=u,u.__data__=a[s],l.delete(d)):n[s]=new Bt(t,a[s]);for(s=0;s<c;++s)(u=e[s])&&l.get(h[s])===u&&(i[s]=u)}function Xr(t){return t.__data__}function Br(t,e){if(!arguments.length)return Array.from(this,Xr);var n=e?Or:qr,r=this._parents,i=this._groups;typeof t!="function"&&(t=Hr(t));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=r[l],f=i[l],h=f.length,d=Vr(t.call(c,c&&c.__data__,l,r)),v=d.length,m=s[l]=new Array(v),b=o[l]=new Array(v),T=u[l]=new Array(h);n(c,f,m,b,T,d,e);for(var $=0,A=0,R,g;$<v;++$)if(R=m[$]){for($>=A&&(A=$+1);!(g=b[A])&&++A<v;);R._next=g||null}}return o=new Y(o,r),o._enter=s,o._exit=u,o}function Vr(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Ur(){return new Y(this._exit||this._groups.map(mn),this._parents)}function Wr(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function Yr(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),u=0;u<o;++u)for(var l=n[u],c=r[u],f=l.length,h=s[u]=new Array(f),d,v=0;v<f;++v)(d=l[v]||c[v])&&(h[v]=d);for(;u<i;++u)s[u]=n[u];return new Y(s,this._parents)}function Gr(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function Zr(t){t||(t=Jr);function e(f,h){return f&&h?t(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o=n[a],s=o.length,u=i[a]=new Array(s),l,c=0;c<s;++c)(l=o[c])&&(u[c]=l);u.sort(e)}return new Y(i,this._parents).order()}function Jr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Kr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Qr(){return Array.from(this)}function jr(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function ti(){let t=0;for(const e of this)++t;return t}function ei(){return!this.node()}function ni(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length,s;a<o;++a)(s=i[a])&&t.call(s,s.__data__,a,i);return this}function ri(t){return function(){this.removeAttribute(t)}}function ii(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ai(t,e){return function(){this.setAttribute(t,e)}}function oi(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function si(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function li(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function ui(t,e){var n=jt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?ii:ri:typeof e=="function"?n.local?li:si:n.local?oi:ai)(n,e))}function yn(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ci(t){return function(){this.style.removeProperty(t)}}function fi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function hi(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function di(t,e,n){return arguments.length>1?this.each((e==null?ci:typeof e=="function"?hi:fi)(t,e,n??"")):mt(this.node(),t)}function mt(t,e){return t.style.getPropertyValue(e)||yn(t).getComputedStyle(t,null).getPropertyValue(e)}function pi(t){return function(){delete this[t]}}function vi(t,e){return function(){this[t]=e}}function gi(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function mi(t,e){return arguments.length>1?this.each((e==null?pi:typeof e=="function"?gi:vi)(t,e)):this.node()[t]}function _n(t){return t.trim().split(/^|\s+/)}function Ae(t){return t.classList||new wn(t)}function wn(t){this._node=t,this._names=_n(t.getAttribute("class")||"")}wn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function xn(t,e){for(var n=Ae(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function bn(t,e){for(var n=Ae(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function yi(t){return function(){xn(this,t)}}function _i(t){return function(){bn(this,t)}}function wi(t,e){return function(){(e.apply(this,arguments)?xn:bn)(this,t)}}function xi(t,e){var n=_n(t+"");if(arguments.length<2){for(var r=Ae(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?wi:e?yi:_i)(n,e))}function bi(){this.textContent=""}function ki(t){return function(){this.textContent=t}}function Ai(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Mi(t){return arguments.length?this.each(t==null?bi:(typeof t=="function"?Ai:ki)(t)):this.node().textContent}function $i(){this.innerHTML=""}function Ni(t){return function(){this.innerHTML=t}}function Ti(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Si(t){return arguments.length?this.each(t==null?$i:(typeof t=="function"?Ti:Ni)(t)):this.node().innerHTML}function Ei(){this.nextSibling&&this.parentNode.appendChild(this)}function Ci(){return this.each(Ei)}function zi(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ii(){return this.each(zi)}function Ri(t){var e=typeof t=="function"?t:dn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Fi(){return null}function Di(t,e){var n=typeof t=="function"?t:dn(t),r=e==null?Fi:typeof e=="function"?e:ke(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Pi(){var t=this.parentNode;t&&t.removeChild(this)}function Li(){return this.each(Pi)}function Hi(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function qi(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Oi(t){return this.select(t?qi:Hi)}function Xi(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Bi(t){return function(e){t.call(this,e,this.__data__)}}function Vi(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Ui(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function Wi(t,e,n){return function(){var r=this.__on,i,a=Bi(e);if(r){for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function Yi(t,e,n){var r=Vi(t+""),i,a=r.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(i=0,c=s[u];i<a;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(s=e?Wi:Ui,i=0;i<a;++i)this.each(s(r[i],e,n));return this}function kn(t,e,n){var r=yn(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Gi(t,e){return function(){return kn(this,t,e)}}function Zi(t,e){return function(){return kn(this,t,e.apply(this,arguments))}}function Ji(t,e){return this.each((typeof e=="function"?Zi:Gi)(t,e))}function*Ki(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var Qi=[null];function Y(t,e){this._groups=t,this._parents=e}function Et(){return new Y([[document.documentElement]],Qi)}function ji(){return this}Y.prototype=Et.prototype={constructor:Y,select:Ar,selectAll:Tr,selectChild:zr,selectChildren:Dr,filter:Pr,data:Br,enter:Lr,exit:Ur,join:Wr,merge:Yr,selection:ji,order:Gr,sort:Zr,call:Kr,nodes:Qr,node:jr,size:ti,empty:ei,each:ni,attr:ui,style:di,property:mi,classed:xi,text:Mi,html:Si,raise:Ci,lower:Ii,append:Ri,insert:Di,remove:Li,clone:Oi,datum:Xi,on:Yi,dispatch:Ji,[Symbol.iterator]:Ki};function Me(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function An(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ct(){}var Nt=.7,Vt=1/Nt,gt="\\s*([+-]?\\d+)\\s*",Tt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",J="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ta=/^#([0-9a-f]{3,8})$/,ea=new RegExp(`^rgb\\(${gt},${gt},${gt}\\)$`),na=new RegExp(`^rgb\\(${J},${J},${J}\\)$`),ra=new RegExp(`^rgba\\(${gt},${gt},${gt},${Tt}\\)$`),ia=new RegExp(`^rgba\\(${J},${J},${J},${Tt}\\)$`),aa=new RegExp(`^hsl\\(${Tt},${J},${J}\\)$`),oa=new RegExp(`^hsla\\(${Tt},${J},${J},${Tt}\\)$`),Pe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Me(Ct,ct,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Le,formatHex:Le,formatHex8:sa,formatHsl:la,formatRgb:He,toString:He});function Le(){return this.rgb().formatHex()}function sa(){return this.rgb().formatHex8()}function la(){return Mn(this).formatHsl()}function He(){return this.rgb().formatRgb()}function ct(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ta.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?qe(e):n===3?new q(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Rt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Rt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ea.exec(t))?new q(e[1],e[2],e[3],1):(e=na.exec(t))?new q(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ra.exec(t))?Rt(e[1],e[2],e[3],e[4]):(e=ia.exec(t))?Rt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=aa.exec(t))?Be(e[1],e[2]/100,e[3]/100,1):(e=oa.exec(t))?Be(e[1],e[2]/100,e[3]/100,e[4]):Pe.hasOwnProperty(t)?qe(Pe[t]):t==="transparent"?new q(NaN,NaN,NaN,0):null}function qe(t){return new q(t>>16&255,t>>8&255,t&255,1)}function Rt(t,e,n,r){return r<=0&&(t=e=n=NaN),new q(t,e,n,r)}function ua(t){return t instanceof Ct||(t=ct(t)),t?(t=t.rgb(),new q(t.r,t.g,t.b,t.opacity)):new q}function de(t,e,n,r){return arguments.length===1?ua(t):new q(t,e,n,r??1)}function q(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Me(q,de,An(Ct,{brighter(t){return t=t==null?Vt:Math.pow(Vt,t),new q(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Nt:Math.pow(Nt,t),new q(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new q(ut(this.r),ut(this.g),ut(this.b),Ut(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Oe,formatHex:Oe,formatHex8:ca,formatRgb:Xe,toString:Xe}));function Oe(){return`#${lt(this.r)}${lt(this.g)}${lt(this.b)}`}function ca(){return`#${lt(this.r)}${lt(this.g)}${lt(this.b)}${lt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xe(){const t=Ut(this.opacity);return`${t===1?"rgb(":"rgba("}${ut(this.r)}, ${ut(this.g)}, ${ut(this.b)}${t===1?")":`, ${t})`}`}function Ut(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ut(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function lt(t){return t=ut(t),(t<16?"0":"")+t.toString(16)}function Be(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new W(t,e,n,r)}function Mn(t){if(t instanceof W)return new W(t.h,t.s,t.l,t.opacity);if(t instanceof Ct||(t=ct(t)),!t)return new W;if(t instanceof W)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new W(o,s,u,t.opacity)}function fa(t,e,n,r){return arguments.length===1?Mn(t):new W(t,e,n,r??1)}function W(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Me(W,fa,An(Ct,{brighter(t){return t=t==null?Vt:Math.pow(Vt,t),new W(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Nt:Math.pow(Nt,t),new W(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new q(ie(t>=240?t-240:t+120,i,r),ie(t,i,r),ie(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new W(Ve(this.h),Ft(this.s),Ft(this.l),Ut(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ut(this.opacity);return`${t===1?"hsl(":"hsla("}${Ve(this.h)}, ${Ft(this.s)*100}%, ${Ft(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Ve(t){return t=(t||0)%360,t<0?t+360:t}function Ft(t){return Math.max(0,Math.min(1,t||0))}function ie(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const $e=t=>()=>t;function ha(t,e){return function(n){return t+n*e}}function da(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function pa(t){return(t=+t)==1?$n:function(e,n){return n-e?da(e,n,t):$e(isNaN(e)?n:e)}}function $n(t,e){var n=e-t;return n?ha(t,n):$e(isNaN(t)?e:t)}const Wt=function t(e){var n=pa(e);function r(i,a){var o=n((i=de(i)).r,(a=de(a)).r),s=n(i.g,a.g),u=n(i.b,a.b),l=$n(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=t,r}(1);function va(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function ga(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ma(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=Ne(t[o],e[o]);for(;o<n;++o)a[o]=e[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function ya(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function U(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function _a(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Ne(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var pe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ae=new RegExp(pe.source,"g");function wa(t){return function(){return t}}function xa(t){return function(e){return t(e)+""}}function Nn(t,e){var n=pe.lastIndex=ae.lastIndex=0,r,i,a,o=-1,s=[],u=[];for(t=t+"",e=e+"";(r=pe.exec(t))&&(i=ae.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:U(r,i)})),n=ae.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?u[0]?xa(u[0].x):wa(e):(e=u.length,function(l){for(var c=0,f;c<e;++c)s[(f=u[c]).i]=f.x(l);return s.join("")})}function Ne(t,e){var n=typeof e,r;return e==null||n==="boolean"?$e(e):(n==="number"?U:n==="string"?(r=ct(e))?(e=r,Wt):Nn:e instanceof ct?Wt:e instanceof Date?ya:ga(e)?va:Array.isArray(e)?ma:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?_a:U)(t,e)}function ba(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Ue=180/Math.PI,ve={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Tn(t,e,n,r,i,a){var o,s,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Ue,skewX:Math.atan(u)*Ue,scaleX:o,scaleY:s}}var Dt;function ka(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ve:Tn(e.a,e.b,e.c,e.d,e.e,e.f)}function Aa(t){return t==null||(Dt||(Dt=document.createElementNS("http://www.w3.org/2000/svg","g")),Dt.setAttribute("transform",t),!(t=Dt.transform.baseVal.consolidate()))?ve:(t=t.matrix,Tn(t.a,t.b,t.c,t.d,t.e,t.f))}function Sn(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function a(l,c,f,h,d,v){if(l!==f||c!==h){var m=d.push("translate(",null,e,null,n);v.push({i:m-4,x:U(l,f)},{i:m-2,x:U(c,h)})}else(f||h)&&d.push("translate("+f+e+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:U(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function s(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:U(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,v){if(l!==f||c!==h){var m=d.push(i(d)+"scale(",null,",",null,")");v.push({i:m-4,x:U(l,f)},{i:m-2,x:U(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=t(l),c=t(c),a(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),s(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var v=-1,m=h.length,b;++v<m;)f[(b=h[v]).i]=b.x(d);return f.join("")}}}var Ma=Sn(ka,"px, ","px)","deg)"),$a=Sn(Aa,", ",")",")"),yt=0,At=0,xt=0,En=1e3,Yt,Mt,Gt=0,ft=0,te=0,St=typeof performance=="object"&&performance.now?performance:Date,Cn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Te(){return ft||(Cn(Na),ft=St.now()+te)}function Na(){ft=0}function Zt(){this._call=this._time=this._next=null}Zt.prototype=zn.prototype={constructor:Zt,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Te():+n)+(e==null?0:+e),!this._next&&Mt!==this&&(Mt?Mt._next=this:Yt=this,Mt=this),this._call=t,this._time=n,ge()},stop:function(){this._call&&(this._call=null,this._time=1/0,ge())}};function zn(t,e,n){var r=new Zt;return r.restart(t,e,n),r}function Ta(){Te(),++yt;for(var t=Yt,e;t;)(e=ft-t._time)>=0&&t._call.call(void 0,e),t=t._next;--yt}function We(){ft=(Gt=St.now())+te,yt=At=0;try{Ta()}finally{yt=0,Ea(),ft=0}}function Sa(){var t=St.now(),e=t-Gt;e>En&&(te-=e,Gt=t)}function Ea(){for(var t,e=Yt,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Yt=n);Mt=t,ge(r)}function ge(t){if(!yt){At&&(At=clearTimeout(At));var e=t-ft;e>24?(t<1/0&&(At=setTimeout(We,t-St.now()-te)),xt&&(xt=clearInterval(xt))):(xt||(Gt=St.now(),xt=setInterval(Sa,En)),yt=1,Cn(We))}}function Ye(t,e,n){var r=new Zt;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Ca=hn("start","end","cancel","interrupt"),za=[],In=0,Ge=1,me=2,qt=3,Ze=4,ye=5,Ot=6;function ee(t,e,n,r,i,a){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Ia(t,n,{name:e,index:r,group:i,on:Ca,tween:za,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:In})}function Se(t,e){var n=G(t,e);if(n.state>In)throw new Error("too late; already scheduled");return n}function K(t,e){var n=G(t,e);if(n.state>qt)throw new Error("too late; already running");return n}function G(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Ia(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=zn(a,0,n.time);function a(l){n.state=Ge,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var c,f,h,d;if(n.state!==Ge)return u();for(c in r)if(d=r[c],d.name===n.name){if(d.state===qt)return Ye(o);d.state===Ze?(d.state=Ot,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<e&&(d.state=Ot,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(Ye(function(){n.state===qt&&(n.state=Ze,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=me,n.on.call("start",t,t.__data__,n.index,n.group),n.state===me){for(n.state=qt,i=new Array(h=n.tween.length),c=0,f=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++f]=d);i.length=f+1}}function s(l){for(var c=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=ye,1),f=-1,h=i.length;++f<h;)i[f].call(t,c);n.state===ye&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=Ot,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function Ra(t,e){var n=t.__transition,r,i,a=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){a=!1;continue}i=r.state>me&&r.state<ye,r.state=Ot,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}a&&delete t.__transition}}function Fa(t){return this.each(function(){Ra(this,t)})}function Da(t,e){var n,r;return function(){var i=K(this,t),a=i.tween;if(a!==n){r=n=a;for(var o=0,s=r.length;o<s;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Pa(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=K(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:e,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===e){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function La(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=G(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?Da:Pa)(n,t,e))}function Ee(t,e,n){var r=t._id;return t.each(function(){var i=K(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return G(i,r).value[e]}}function Rn(t,e){var n;return(typeof e=="number"?U:e instanceof ct?Wt:(n=ct(e))?(e=n,Wt):Nn)(t,e)}function Ha(t){return function(){this.removeAttribute(t)}}function qa(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Oa(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function Xa(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function Ba(t,e,n){var r,i,a;return function(){var o,s=n(this),u;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=s+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s)))}}function Va(t,e,n){var r,i,a;return function(){var o,s=n(this),u;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=s+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s)))}}function Ua(t,e){var n=jt(t),r=n==="transform"?$a:Rn;return this.attrTween(t,typeof e=="function"?(n.local?Va:Ba)(n,r,Ee(this,"attr."+t,e)):e==null?(n.local?qa:Ha)(n):(n.local?Xa:Oa)(n,r,e))}function Wa(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Ya(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Ga(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&Ya(t,a)),n}return i._value=e,i}function Za(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&Wa(t,a)),n}return i._value=e,i}function Ja(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=jt(t);return this.tween(n,(r.local?Ga:Za)(r,e))}function Ka(t,e){return function(){Se(this,t).delay=+e.apply(this,arguments)}}function Qa(t,e){return e=+e,function(){Se(this,t).delay=e}}function ja(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Ka:Qa)(e,t)):G(this.node(),e).delay}function to(t,e){return function(){K(this,t).duration=+e.apply(this,arguments)}}function eo(t,e){return e=+e,function(){K(this,t).duration=e}}function no(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?to:eo)(e,t)):G(this.node(),e).duration}function ro(t,e){if(typeof e!="function")throw new Error;return function(){K(this,t).ease=e}}function io(t){var e=this._id;return arguments.length?this.each(ro(e,t)):G(this.node(),e).ease}function ao(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;K(this,t).ease=n}}function oo(t){if(typeof t!="function")throw new Error;return this.each(ao(this._id,t))}function so(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],u,l=0;l<o;++l)(u=a[l])&&t.call(u,u.__data__,l,a)&&s.push(u);return new nt(r,this._parents,this._name,this._id)}function lo(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u=e[s],l=n[s],c=u.length,f=o[s]=new Array(c),h,d=0;d<c;++d)(h=u[d]||l[d])&&(f[d]=h);for(;s<r;++s)o[s]=e[s];return new nt(o,this._parents,this._name,this._id)}function uo(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function co(t,e,n){var r,i,a=uo(e)?Se:K;return function(){var o=a(this,t),s=o.on;s!==r&&(i=(r=s).copy()).on(e,n),o.on=i}}function fo(t,e){var n=this._id;return arguments.length<2?G(this.node(),n).on.on(t):this.each(co(n,t,e))}function ho(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function po(){return this.on("end.remove",ho(this._id))}function vo(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ke(t));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s=r[o],u=s.length,l=a[o]=new Array(u),c,f,h=0;h<u;++h)(c=s[h])&&(f=t.call(c,c.__data__,h,s))&&("__data__"in c&&(f.__data__=c.__data__),l[h]=f,ee(l[h],e,n,h,l,G(c,n)));return new nt(a,this._parents,e,n)}function go(t){var e=this._name,n=this._id;typeof t!="function"&&(t=pn(t));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var u=r[s],l=u.length,c,f=0;f<l;++f)if(c=u[f]){for(var h=t.call(c,c.__data__,f,u),d,v=G(c,n),m=0,b=h.length;m<b;++m)(d=h[m])&&ee(d,e,n,m,h,v);a.push(h),o.push(c)}return new nt(a,o,e,n)}var mo=Et.prototype.constructor;function yo(){return new mo(this._groups,this._parents)}function _o(t,e){var n,r,i;return function(){var a=mt(this,t),o=(this.style.removeProperty(t),mt(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}function Fn(t){return function(){this.style.removeProperty(t)}}function wo(t,e,n){var r,i=n+"",a;return function(){var o=mt(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}function xo(t,e,n){var r,i,a;return function(){var o=mt(this,t),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(t),mt(this,t))),o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s))}}function bo(t,e){var n,r,i,a="style."+e,o="end."+a,s;return function(){var u=K(this,t),l=u.on,c=u.value[a]==null?s||(s=Fn(e)):void 0;(l!==n||i!==c)&&(r=(n=l).copy()).on(o,i=c),u.on=r}}function ko(t,e,n){var r=(t+="")=="transform"?Ma:Rn;return e==null?this.styleTween(t,_o(t,r)).on("end.style."+t,Fn(t)):typeof e=="function"?this.styleTween(t,xo(t,r,Ee(this,"style."+t,e))).each(bo(this._id,t)):this.styleTween(t,wo(t,r,e),n).on("end.style."+t,null)}function Ao(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Mo(t,e,n){var r,i;function a(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Ao(t,o,n)),r}return a._value=e,a}function $o(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Mo(t,e,n??""))}function No(t){return function(){this.textContent=t}}function To(t){return function(){var e=t(this);this.textContent=e??""}}function So(t){return this.tween("text",typeof t=="function"?To(Ee(this,"text",t)):No(t==null?"":t+""))}function Eo(t){return function(e){this.textContent=t.call(this,e)}}function Co(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Eo(i)),e}return r._value=t,r}function zo(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Co(t))}function Io(){for(var t=this._name,e=this._id,n=Dn(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,u,l=0;l<s;++l)if(u=o[l]){var c=G(u,e);ee(u,t,n,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new nt(r,this._parents,t,n)}function Ro(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},u={value:function(){--i===0&&a()}};n.each(function(){var l=K(this,r),c=l.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),l.on=e}),i===0&&a()})}var Fo=0;function nt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Dn(){return++Fo}var tt=Et.prototype;nt.prototype={constructor:nt,select:vo,selectAll:go,selectChild:tt.selectChild,selectChildren:tt.selectChildren,filter:so,merge:lo,selection:yo,transition:Io,call:tt.call,nodes:tt.nodes,node:tt.node,size:tt.size,empty:tt.empty,each:tt.each,on:fo,attr:Ua,attrTween:Ja,style:ko,styleTween:$o,text:So,textTween:zo,remove:po,tween:La,delay:ja,duration:no,ease:io,easeVarying:oo,end:Ro,[Symbol.iterator]:tt[Symbol.iterator]};function Do(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Po={time:null,delay:0,duration:250,ease:Do};function Lo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Ho(t){var e,n;t instanceof nt?(e=t._id,t=t._name):(e=Dn(),(n=Po).time=Te(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&ee(u,t,e,l,o,n||Lo(u,e));return new nt(r,this._parents,t,e)}Et.prototype.interrupt=Fa;Et.prototype.transition=Ho;const _e=Math.PI,we=2*_e,st=1e-6,qo=we-st;function Pn(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Oo(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Pn;const n=10**e;return function(r){this._+=r[0];for(let i=1,a=r.length;i<a;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class Xo{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?Pn:Oo(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,a,o){this._append`C${+e},${+n},${+r},${+i},${this._x1=+a},${this._y1=+o}`}arcTo(e,n,r,i,a){if(e=+e,n=+n,r=+r,i=+i,a=+a,a<0)throw new Error(`negative radius: ${a}`);let o=this._x1,s=this._y1,u=r-e,l=i-n,c=o-e,f=s-n,h=c*c+f*f;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(h>st)if(!(Math.abs(f*u-l*c)>st)||!a)this._append`L${this._x1=e},${this._y1=n}`;else{let d=r-o,v=i-s,m=u*u+l*l,b=d*d+v*v,T=Math.sqrt(m),$=Math.sqrt(h),A=a*Math.tan((_e-Math.acos((m+h-b)/(2*T*$)))/2),R=A/$,g=A/T;Math.abs(R-1)>st&&this._append`L${e+R*c},${n+R*f}`,this._append`A${a},${a},0,0,${+(f*d>c*v)},${this._x1=e+g*u},${this._y1=n+g*l}`}}arc(e,n,r,i,a,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let s=r*Math.cos(i),u=r*Math.sin(i),l=e+s,c=n+u,f=1^o,h=o?i-a:a-i;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>st||Math.abs(this._y1-c)>st)&&this._append`L${l},${c}`,r&&(h<0&&(h=h%we+we),h>qo?this._append`A${r},${r},0,1,${f},${e-s},${n-u}A${r},${r},0,1,${f},${this._x1=l},${this._y1=c}`:h>st&&this._append`A${r},${r},0,${+(h>=_e)},${f},${this._x1=e+r*Math.cos(a)},${this._y1=n+r*Math.sin(a)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}var Je={},oe={},se=34,bt=10,le=13;function Ln(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function Bo(t,e){var n=Ln(t);return function(r,i){return e(n(r),i,t)}}function Ke(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function H(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function Vo(t){return t<0?"-"+H(-t,6):t>9999?"+"+H(t,6):H(t,4)}function Uo(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Vo(t.getUTCFullYear())+"-"+H(t.getUTCMonth()+1,2)+"-"+H(t.getUTCDate(),2)+(i?"T"+H(e,2)+":"+H(n,2)+":"+H(r,2)+"."+H(i,3)+"Z":r?"T"+H(e,2)+":"+H(n,2)+":"+H(r,2)+"Z":n||e?"T"+H(e,2)+":"+H(n,2)+"Z":"")}function Wo(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(f,h){var d,v,m=i(f,function(b,T){if(d)return d(b,T-1);v=b,d=h?Bo(b,h):Ln(b)});return m.columns=v||[],m}function i(f,h){var d=[],v=f.length,m=0,b=0,T,$=v<=0,A=!1;f.charCodeAt(v-1)===bt&&--v,f.charCodeAt(v-1)===le&&--v;function R(){if($)return oe;if(A)return A=!1,Je;var _,w=m,x;if(f.charCodeAt(w)===se){for(;m++<v&&f.charCodeAt(m)!==se||f.charCodeAt(++m)===se;);return(_=m)>=v?$=!0:(x=f.charCodeAt(m++))===bt?A=!0:x===le&&(A=!0,f.charCodeAt(m)===bt&&++m),f.slice(w+1,_-1).replace(/""/g,'"')}for(;m<v;){if((x=f.charCodeAt(_=m++))===bt)A=!0;else if(x===le)A=!0,f.charCodeAt(m)===bt&&++m;else if(x!==n)continue;return f.slice(w,_)}return $=!0,f.slice(w,v)}for(;(T=R())!==oe;){for(var g=[];T!==Je&&T!==oe;)g.push(T),T=R();h&&(g=h(g,b++))==null||d.push(g)}return d}function a(f,h){return f.map(function(d){return h.map(function(v){return c(d[v])}).join(t)})}function o(f,h){return h==null&&(h=Ke(f)),[h.map(c).join(t)].concat(a(f,h)).join(`
`)}function s(f,h){return h==null&&(h=Ke(f)),a(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(t)}function c(f){return f==null?"":f instanceof Date?Uo(f):e.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:s,formatRows:u,formatRow:l,formatValue:c}}var Yo=Wo(","),Go=Yo.parse;function Zo(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function Jo(t,e){return fetch(t,e).then(Zo)}function Ko(t){return function(e,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=void 0),Jo(e,n).then(function(i){return t(i,r)})}}var Qo=Ko(Go);function jo(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Jt(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function _t(t){return t=Jt(Math.abs(t)),t?t[1]:NaN}function ts(t,e){return function(n,r){for(var i=n.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(n.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(e)}}function es(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var ns=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Kt(t){if(!(e=ns.exec(t)))throw new Error("invalid format: "+t);var e;return new Ce({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Kt.prototype=Ce.prototype;function Ce(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Ce.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function rs(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var Hn;function is(t,e){var n=Jt(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(Hn=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Jt(t,Math.max(0,e+a-1))[0]}function Qe(t,e){var n=Jt(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const je={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:jo,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Qe(t*100,e),r:Qe,s:is,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function tn(t){return t}var en=Array.prototype.map,nn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function as(t){var e=t.grouping===void 0||t.thousands===void 0?tn:ts(en.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?tn:es(en.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function l(f){f=Kt(f);var h=f.fill,d=f.align,v=f.sign,m=f.symbol,b=f.zero,T=f.width,$=f.comma,A=f.precision,R=f.trim,g=f.type;g==="n"?($=!0,g="g"):je[g]||(A===void 0&&(A=12),R=!0,g="g"),(b||h==="0"&&d==="=")&&(b=!0,h="0",d="=");var _=m==="$"?n:m==="#"&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",w=m==="$"?r:/[%p]/.test(g)?o:"",x=je[g],S=/[defgprs%]/.test(g);A=A===void 0?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function D(y){var P=_,z=w,Q,wt,at;if(g==="c")z=x(y)+z,y="";else{y=+y;var j=y<0||1/y<0;if(y=isNaN(y)?u:x(Math.abs(y),A),R&&(y=rs(y)),j&&+y==0&&v!=="+"&&(j=!1),P=(j?v==="("?v:s:v==="-"||v==="("?"":v)+P,z=(g==="s"?nn[8+Hn/3]:"")+z+(j&&v==="("?")":""),S){for(Q=-1,wt=y.length;++Q<wt;)if(at=y.charCodeAt(Q),48>at||at>57){z=(at===46?i+y.slice(Q+1):y.slice(Q))+z,y=y.slice(0,Q);break}}}$&&!b&&(y=e(y,1/0));var ot=P.length+y.length+z.length,O=ot<T?new Array(T-ot+1).join(h):"";switch($&&b&&(y=e(O+y,O.length?T-z.length:1/0),O=""),d){case"<":y=P+y+z+O;break;case"=":y=P+O+y+z;break;case"^":y=O.slice(0,ot=O.length>>1)+P+y+z+O.slice(ot);break;default:y=O+P+y+z;break}return a(y)}return D.toString=function(){return f+""},D}function c(f,h){var d=l((f=Kt(f),f.type="f",f)),v=Math.max(-8,Math.min(8,Math.floor(_t(h)/3)))*3,m=Math.pow(10,-v),b=nn[8+v/3];return function(T){return d(m*T)+b}}return{format:l,formatPrefix:c}}var Pt,qn,On;os({thousands:",",grouping:[3],currency:["$",""]});function os(t){return Pt=as(t),qn=Pt.format,On=Pt.formatPrefix,Pt}function ss(t){return Math.max(0,-_t(Math.abs(t)))}function ls(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_t(e)/3)))*3-_t(Math.abs(t)))}function us(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,_t(e)-_t(t))+1}function cs(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function fs(t){return function(){return t}}function hs(t){return+t}var rn=[0,1];function vt(t){return t}function xe(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:fs(isNaN(e)?NaN:.5)}function ds(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function ps(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=xe(i,r),a=n(o,a)):(r=xe(r,i),a=n(a,o)),function(s){return a(r(s))}}function vs(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=xe(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(s){var u=cr(t,s,1,r)-1;return a[u](i[u](s))}}function gs(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ms(){var t=rn,e=rn,n=Ne,r,i,a,o=vt,s,u,l;function c(){var h=Math.min(t.length,e.length);return o!==vt&&(o=ds(t[0],t[h-1])),s=h>2?vs:ps,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?a:(u||(u=s(t.map(r),e,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=s(e,t.map(r),U)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,hs),c()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),c()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=ba,c()},f.clamp=function(h){return arguments.length?(o=h?!0:vt,c()):o!==vt},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(a=h,f):a},function(h,d){return r=h,i=d,c()}}function ys(){return ms()(vt,vt)}function _s(t,e,n,r){var i=vr(t,e,n),a;switch(r=Kt(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=ls(i,o))&&(r.precision=a),On(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=us(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=ss(i))&&(r.precision=a-(r.type==="%")*2);break}}return qn(r)}function ws(t){var e=t.domain;return t.ticks=function(n){var r=e();return pr(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return _s(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,o=r[i],s=r[a],u,l,c=10;for(s<o&&(l=o,o=s,s=l,l=i,i=a,a=l);c-- >0;){if(l=fe(o,s,n),l===u)return r[i]=o,r[a]=s,e(r);if(l>0)o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l;else if(l<0)o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l;else break;u=l}return t},t}function be(){var t=ys();return t.copy=function(){return gs(t,be())},cs.apply(t,arguments),ws(t)}function ht(t){return function(){return t}}function xs(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Xo(e)}function bs(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Xn(t){this._context=t}Xn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function ks(t){return new Xn(t)}function As(t){return t[0]}function Ms(t){return t[1]}function $s(t,e){var n=ht(!0),r=null,i=ks,a=null,o=xs(s);t=typeof t=="function"?t:t===void 0?As:ht(t),e=typeof e=="function"?e:e===void 0?Ms:ht(e);function s(u){var l,c=(u=bs(u)).length,f,h=!1,d;for(r==null&&(a=i(d=o())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===h&&((h=!h)?a.lineStart():a.lineEnd()),h&&a.point(+t(f,l,u),+e(f,l,u));if(d)return a=null,d+""||null}return s.x=function(u){return arguments.length?(t=typeof u=="function"?u:ht(+u),s):t},s.y=function(u){return arguments.length?(e=typeof u=="function"?u:ht(+u),s):e},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:ht(!!u),s):n},s.curve=function(u){return arguments.length?(i=u,r!=null&&(a=i(r)),s):i},s.context=function(u){return arguments.length?(u==null?r=a=null:a=i(r=u),s):r},s}function $t(t,e,n){this.k=t,this.x=e,this.y=n}$t.prototype={constructor:$t,scale:function(t){return t===1?this:new $t(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new $t(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};$t.prototype;var Ns=rt('<div class="legend-item svelte-4o8g80"><svg width="24" height="12" viewBox="0 0 24 12" class="svelte-4o8g80"><path d="M0,6 L24,6" stroke-width="3" fill="none"></path></svg> <span class="legend-text svelte-4o8g80"> </span></div>'),Ts=Qt('<line stroke="#333" stroke-width="1"></line><text fill="#fff" text-anchor="end" dominant-baseline="middle" class="svelte-4o8g80"> </text>',1),Ss=Qt('<line stroke="#333" stroke-width="1"></line><text fill="#fff" text-anchor="middle" class="svelte-4o8g80"> </text>',1),Es=Qt('<path fill="none" stroke-width="3"></path>'),Cs=Qt('<text fill="#fff" text-anchor="middle" transform="rotate(-90, 10, 200)" class="y-axis-title svelte-4o8g80"> </text>'),zs=rt('<div class="chart-container svelte-4o8g80"><h2 class="svelte-4o8g80"> </h2> <div class="legend-container svelte-4o8g80"></div> <svg height="400"><rect height="400" fill="#000"></rect><!><!><!><!></svg></div>');function kt(t,e){an(e,!1);let n=et(e,"path_to_data",8,""),r=et(e,"title",8,""),i=et(e,"yticks",24,()=>[]),a=et(e,"y_axis_title",8,""),o=Z(750),s=Z([]),u=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],l=["#8DBF2E","#00A189","#6FC7EA","#007FA3","#AB1368","#DC4633","#F1C500"];cn(()=>{const g=()=>{const _=document.querySelector(".chart-container");_&&L(o,Math.min(p(o),_.parentElement.clientWidth))};return g(),window.addEventListener("resize",g),Qo(n()).then(_=>{L(s,_.map(w=>{const x={Hour:+w.Hour};return u.forEach(S=>x[S]=+w[S]),x}))}),()=>window.removeEventListener("resize",g)});let c=Z();ue(()=>(p(s),p(o),Un(i())),()=>{if(p(s).length>0){const g=be().domain([0,23]).range([50,p(o)-20]),_=be().domain([mr(i()),gr(i())]).range([360,40]),w=$s().x(y=>g(y.Hour)).y(y=>_(y.value)),x=u.map(y=>{const P=y==="Saturday"||y==="Sunday";return{day:y,path:w(p(s).map(z=>({Hour:z.Hour,value:z[y]}))),color:l[u.indexOf(y)],isDashed:P}}),S=Array.from({length:24},(y,P)=>P),D=[...i()];L(c,{x:g,y:_,lines:x,xTicks:S,yTicks:D})}}),on(),un();var f=zs(),h=C(f),d=C(h,!0);M(h);var v=N(h,2);dt(v,5,()=>{var g;return(g=p(c))==null?void 0:g.lines},pt,(g,_)=>{var w=Ns(),x=C(w),S=C(x);M(x);var D=N(x,2),y=C(D,!0);M(D),M(w),F(()=>{k(S,"stroke",p(_).color),k(S,"stroke-dasharray",p(_).isDashed?"4,2":"0"),it(y,p(_).day)}),B(g,w)}),M(v);var m=N(v,2),b=C(m),T=N(b);dt(T,1,()=>{var g;return(g=p(c))==null?void 0:g.yTicks},pt,(g,_)=>{var w=Ts(),x=ce(w);k(x,"x1",50),F(()=>k(x,"y1",p(c).y(p(_)))),F(()=>k(x,"y2",p(c).y(p(_))));var S=N(x);k(S,"x",45),F(()=>k(S,"y",p(c).y(p(_))));var D=C(S,!0);M(S),F(()=>{k(x,"x2",p(o)-20),it(D,p(_))}),B(g,w)});var $=N(T);dt($,1,()=>{var g;return(g=p(c))==null?void 0:g.xTicks},pt,(g,_)=>{var w=Ss(),x=ce(w);F(()=>k(x,"x1",p(c).x(p(_)))),k(x,"y1",360),F(()=>k(x,"x2",p(c).x(p(_)))),k(x,"y2",40);var S=N(x);F(()=>k(S,"x",p(c).x(p(_)))),k(S,"y",375);var D=C(S,!0);M(S),F(()=>it(D,p(_))),B(g,w)});var A=N($);dt(A,1,()=>{var g;return(g=p(c))==null?void 0:g.lines},pt,(g,_)=>{var w=Es();F(()=>{k(w,"d",p(_).path),k(w,"stroke",p(_).color),k(w,"stroke-dasharray",p(_).isDashed?"4,2":"0")}),B(g,w)});var R=N(A);ln(R,a,g=>{var _=Cs();k(_,"x",15),k(_,"y",205);var w=C(_,!0);M(_),F(()=>it(w,a())),B(g,_)}),M(m),M(f),F(()=>{k(f,"style",`width: ${p(o)??""}px; height: 450px;`),it(d,r()),k(m,"width",p(o)),k(m,"viewBox",`0 0 ${p(o)} 400`),k(b,"width",p(o))}),B(t,f),sn()}const Is=""+new URL("../assets/top-image.JUTWmls1.png",import.meta.url).href;var Rs=rt(`<!> <main class="svelte-uz1plv"><div class="title svelte-uz1plv"><img alt="" class="svelte-uz1plv"> <h1 class="svelte-uz1plv">Exploring hourly activity patterns in Toronto</h1> <p id="authors" class="svelte-uz1plv"><a href="https://camhkerr.com/" target="_blank" class="svelte-uz1plv">Cameron Kerr</a>, <a href="https://www.urbandisplacement.org/team/julia-greenberg/" target="_blank" class="svelte-uz1plv">Julia Greenberg</a>, <a href="https://jamaps.github.io/" target="_blank" class="svelte-uz1plv">Jeff Allen</a> |
		June 2025</p></div> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Metropolitan regions are constantly changing, complex systems. As their inhabitants and visitors commute between home and work, run
		errands, and engage in other activities, regions develop their own unique pulse and rhythm.</p> <p class="svelte-uz1plv">The following visualizations illustrate this movement throughout the Greater Toronto Area (GTA)–a region with 
		almost 7 million people and a mix of urban, rural, and suburban communities–at different hours of the day using data collected 
		from mobile devices.</p> <p class="svelte-uz1plv">To do so, we selected over 16,000 grid cells, each about 1 kilometer wide, across the GTA. For each of these grid cells, we measured hourly activity by calculating the <i>accumulated time</i> that a sample of mobile devices (i.e., cell phones) spent in each grid 
		cell. For example, if two mobile devices each spent 30 minutes of a given hour in a given cell, the region would be assigned an 
		accumulated time of 1 for that hour. The sample of mobile device location data was provided by <a href="https://cuebiq.com/social-impact/" target="_blank" class="svelte-uz1plv">Cuebiq</a>.</p> <p class="svelte-uz1plv">We then mapped the results and calculated statistics summarizing the patterns that we observed.</p> <p class="svelte-uz1plv">The first map below shows the total accumulated time for each hour (shown using the 24 hour clock) of the average weekday and weekend in the summer of 2024 in the GTA. There isn't much fluctuation, demonstrating that the spatial distribution of total hourly activity is relatively constant. Activity at all hours during both types of days is consistently concentrated in specific locations (e.g. downtown Toronto)</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">However, the map does reveal some interesting trends when looking closely. In the region overall, there is less activity at night.
		There is also a notable dark area on the map where the Pearson International Airport is located, indicating that there is
		generally less activity there compared to other parts of the region at night.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">The plot above shows the number of active devices in the sample during each hour throughout the week. The observed drop could be 
		due to the nature of the device location data, as lower overall levels of movement at night may result in fewer instances of devices' 
		locations being collected by the data provider. Another factor could be commuters coming into the GTA to work during the day and 
		leaving the region at night.</p> <p class="svelte-uz1plv">In the map shown above, the underlying population density of the region distribution obscures hourly changes in activity. 
		In other words, since there are almost always more people in the city of Toronto (especially downtown) than anywhere else in the region, the spatial distribution of overall activity levels always looks fairly similar.</p> <p class="svelte-uz1plv">To better illustrate <i>relative</i> changes in activity, the map below shows the difference between each individual cell's hourly 
		activity and its <i>average</i> hourly activity throughout the summer of 2024. This new metric
		measures how much more or less activity occurs in a given cell compared to the typical level of activity in that cell.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Patterns of movement throughout the region are much more pronounced in this version of the map. This map reveals that people cluster in employment centers during weekdays and then become more dispersed during weekday evenings. For example, the southeastern part of 
		Brampton and northeastern Mississauga is a massive employment area that becomes busier than usual during weekday working hours. During weekday evenings, on the other hand, the more residential northern and western parts of Brampton experience higher than average activity.</p> <p class="svelte-uz1plv">This trend of increased activity in employment zones during weekday working hours is prevalent throughout the GTA, including
		in the southern part of Vaughan, parts of Markham, and in downtown Toronto. Areas that mostly consist of residential buildings (rather than retail and commercial) have more activity in the evenings. Commuting patterns are also highlighted in the weekday version of the map, as activity visibly increases between 3 pm and 6 pm on Highway 400, Highway 401, and the QEW.</p> <p class="svelte-uz1plv">Spatial patterns during the weekend are somewhat similar to weekday patterns, with some key differences. While weekday activity
		generally begins around 7 am, especially in the northwest part of the region and around the airport, on weekends
		there is still low overall activity at this time. Weekend activity picks up a few hours later, around 10 or 11 am.</p> <p class="svelte-uz1plv">Activity during the day is also more evenly spread out throughout the region on weekends, and does not concentrate in major 
		employment areas like on weekdays. During both weekends and weekdays, however, activity in the central part of the city 
		of Toronto increases significantly around 10 or 11 pm.</p> <h2 class="svelte-uz1plv">Diversity and clustering</h2> <p class="svelte-uz1plv">Diversity and clustering statistics were used to quantify the daily patterns observed in the maps above. <a href="https://en.wikipedia.org/wiki/Diversity_index#Shannon_index" target="_blank" class="svelte-uz1plv">Shannon's Diversity 
		Index</a> captures both <i>richness</i> (the number of grid cells on the map with activity) and <i>evenness</i> (how evenly that 
		activity is distributed among them).</p> <p class="svelte-uz1plv">A high Shannon Index means that many cells have activity and that activity levels are relatively balanced across them. In contrast, 
		a low Shannon Index suggests that fewer cells are experiencing activity and that activity is concentrated in specific cells.</p> <p class="svelte-uz1plv">Note that this index is "spatially unaware". In other words, if all the cells were shuffled into different positions on the map, the 
		Shannon index value would remain the same.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">The plot above shows that activity becomes more <i>spatially diverse</i> during daytime hours, peaking between 3 pm and 5 pm, and then decreases in the evening and remains low throughout the night. Although differences in the actual index values are relatively small, an <a href="https://search.r-project.org/CRAN/refmans/ARTool/html/art.html" target="_blank" class="svelte-uz1plv">Aligned Rank Transform (ART) ANOVA</a> test confirmed that the variation in diversity between day and night is statistically 
		significant.</p> <p class="svelte-uz1plv">One possible explanation is that during the day, people are more mobile and spend less time staying fixed in specific locations
		relative to evenings, especially during commuting hours (when diversity peaks). The diversity index also increases slightly later in 
		the day on weekends compared to weekdays, likely corresponding with non-work weekend routines.</p> <p class="svelte-uz1plv">As mentioned above, Shannon's Index reflects both <i>richness</i> and <i>evenness</i>. To better understand each component's 
		contribution to diversity, they were examined seperately. Richness, in this case, represents the number of cells in the GTA that 
		are visited within a given hour. Evenness indicates the degree to which activity is uniformly distributed throughout the region.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Richness (the proportion of grid cells experiencing activity) reveals a pattern similar to Shannon's Diversity Index. During the day, 
		more people are moving around, generating activity in a large number of cells. At night, activity becomes concentrated in 
		residential areas, leaving roughly half of the cells inactive.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">Evenness (how evenly activity is spread out throughout the region) follows a reverse pattern. It generally 
		spikes at night around 3 am and gradually decreases during the day, likely reflecting the transition from home to more concentrated areas of work and leisure.</p> <p class="svelte-uz1plv">Evenness also increases again slightly on weekdays between 3 pm and 5 pm, most likely a result of commuters spreading out throughout the GTA as they leave work.</p> <p class="svelte-uz1plv">In addition to diversity indices, clustering was calculated using the <a href="https://en.wikipedia.org/wiki/Moran%27s_I" target="_blank" class="svelte-uz1plv">Moran's I</a> statistic for each hour throughout the week. A high, positive (between 0 and +1) Moran’s I value indicates that cells with similar activity are geographically close to each other, suggesting strong spatial autocorrelation. A value near zero suggests that activity levels are randomly distributed across space. A low negative value (between 0 and -1) indicates that high-activity cells are typically surrounded by low-activity cells and vice versa.</p></div> <!> <div class="text svelte-uz1plv"><p class="svelte-uz1plv">The plot above reveals that activity is more spatially concentrated during the day, especially in late afternoons, compared to 
		evenings and nights, when activity is more dispersed. This clustering trend is relatively similar to the trends for diversity and
		richness.</p> <p class="svelte-uz1plv">However, one noticeable difference is that the clustering plot shows a larger disparity between weekends and weekdays compared
		to the diversity and richness plots. On Saturdays and especially Sundays, there is less spatial clustering during the day compared to
		weekdays.</p> <p class="svelte-uz1plv">In other words, on weekend mornings and afternoons, there is a similar, even slightly higher proportion of grid cells with activity compared to weekday mornings and afternoons. However, the places where people spend time on weekend mornings and afternoons are less spatially concentrated. This makes sense, given that employment centers tend to be in specific areas whereas leisure activities are generally more spread out.</p></div></main>`,1);function Bs(t){var e=Rs(),n=ce(e);tr(n);var r=N(n,2),i=C(r),a=C(i);k(a,"src",Is),Ie(4),M(i);var o=N(i,4);Re(o,{title:"Mean hourly activity in Toronto",folder_weekday:"exploring-hourly-activity-toronto/Weekday_Total_small",folder_weekend:"exploring-hourly-activity-toronto/Weekend_Total_small",legendColors:["#331d33","#c53e2e","#eddd53"],legendLabels:["Few active mobile devices","Many active mobile devices"]});var s=N(o,4);kt(s,{path_to_data:"exploring-hourly-activity-toronto/data/pings_normalized.csv",title:"Hourly activity in Toronto by day of the week",yticks:[.5,.75,1,1.25,1.5],y_axis_title:"Mean normalized hourly activity"});var u=N(s,4);Re(u,{title:"Mean-subtracted hourly activity in Toronto",folder_weekday:"exploring-hourly-activity-toronto/Weekday_Difference_small",folder_weekend:"exploring-hourly-activity-toronto/Weekend_Difference_small",legendColors:["#d0f9ff","#4ca4c3","#331d33","#c53e2e","#eddd53"],legendLabels:["Relatively low activity","Mean activity","Relatively high activity"]});var l=N(u,4);kt(l,{path_to_data:"exploring-hourly-activity-toronto/data/shannon.csv",title:"Shannon diversity index of hourly activity in Toronto",yticks:[7.9,8,8.1,8.2],y_axis_title:""});var c=N(l,4);kt(c,{path_to_data:"exploring-hourly-activity-toronto/data/richness.csv",title:"Proportion of cells with activity throughout the day",yticks:[.4,.5,.6,.7],y_axis_title:"Richness"});var f=N(c,4);kt(f,{path_to_data:"exploring-hourly-activity-toronto/data/evenness.csv",title:"Evenness of activity throughout the day",yticks:[.86,.87,.88,.89,.9],y_axis_title:"Evenness"});var h=N(f,4);kt(h,{path_to_data:"exploring-hourly-activity-toronto/data/moran.csv",title:"Spatial clustering of hourly activity in Toronto",yticks:[.34,.38,.42,.46],y_axis_title:"Moran's I of hourly activity in Toronto"}),Ie(2),M(r),B(t,e)}export{Bs as component,Xs as universal};
